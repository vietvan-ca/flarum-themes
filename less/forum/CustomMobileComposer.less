// Mobile Composer - X button positioning only
@media (max-width: 768px) {
  // Hide default Flarum composer on mobile
  #composer {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }
  
  // But if it's already open (desktop -> mobile resize), just move X button  
  #composer.in,
  #composer.fade.in {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
    
    .Composer-header {
      position: relative;
      
      // Move close/minimize button to the right
      .item-minimize.App-backControl {
        position: absolute !important;
        right: 15px !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        left: auto !important;
        margin-left: 0 !important;
        
        button {
          background: transparent !important;
          border: none !important;
          color: var(--muted-more-color, #666) !important;
          font-size: 18px !important;
          padding: 8px !important;
          
          .Button-label {
            display: none !important;
          }
        }
      }
      
      // Make room for close button
      .App-titleControl,
      h3,
      .ComposerBody-header > li:first-child {
        margin-right: 60px !important;
      }
    }
  }
}

// Custom Mobile Create Topic Modal
.CustomMobileCreateModal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: white;
  z-index: 10000;
  display: none;
  flex-direction: column;

  @media (max-width: 768px) {
    &.visible {
      display: flex !important;
    }
  }

  @media (min-width: 769px) {
    display: none !important;
  }

  &-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    border-bottom: 1px solid #e8e8e8;
    background: #f8f8f8;

    h2 {
      margin: 0;
      font-size: 18px;
      color: #333;
    }

    .close-btn {
      background: transparent;
      border: none;
      font-size: 20px;
      color: #666;
      padding: 8px;
      border-radius: 50%;
    }
  }

  &-content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;

    .form-group {
      margin-bottom: 20px;

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
      }

      input, select, textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: white;
        box-sizing: border-box;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        
        &:focus {
          outline: none;
          border-color: #C22126;
          box-shadow: 0 0 0 2px rgba(194, 33, 38, 0.2);
        }
        
        &::placeholder {
          color: #999;
          opacity: 1;
        }
      }

      .TextEditor-container {
        border: 1px solid #ddd;
        border-radius: 6px;
        min-height: 200px;
        
        .TextEditor {
          border: none;
          
          &-editor {
            padding: 12px;
            font-size: 16px;
            min-height: 180px;
            
            &:focus {
              outline: none;
            }
          }
          
          &-toolbar {
            padding: 8px 12px;
            border-bottom: 1px solid #e8e8e8;
            background: #f8f8f8;
            
            // Mobile direct upload styling
            &.TextEditor-toolbar--mobile-direct {
              .Button--direct-upload {
                background: #C22126;
                color: white;
                border: none;
                border-radius: 4px;
                padding: 8px 12px;
                font-size: 14px;
                margin-right: 8px;
                
                &:hover {
                  background: darken(#C22126, 10%);
                }
                
                .icon {
                  margin-right: 4px;
                }
                
                // Style file input
                input[type="file"] {
                  position: absolute;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  opacity: 0;
                  cursor: pointer;
                }
              }
              
              // Hide any gallery-related buttons
              .Button--icon[title*="Gallery"],
              .Button--icon[data-tooltip*="Gallery"],
              .Button--icon[aria-label*="Gallery"],
              button[class*="gallery"] {
                display: none !important;
              }
            }
          }
        }
        
        &:focus-within {
          border-color: #C22126;
          box-shadow: 0 0 0 2px rgba(194, 33, 38, 0.2);
        }
      }

      select {
        cursor: pointer;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 16px;
        padding-right: 40px;
      }

      textarea {
        min-height: 200px;
        max-height: 400px;
        resize: vertical;
        line-height: 1.5;
        
        // Ensure proper text rendering on mobile
        -webkit-text-size-adjust: 100%;
        -moz-text-size-adjust: 100%;
        text-size-adjust: 100%;
        
        // Prevent zoom on iOS
        @media (max-width: 768px) {
          font-size: 16px !important;
        }
      }
    }
  }

  &-footer {
    padding: 15px;
    border-top: 1px solid #e8e8e8;
    background: #f8f8f8;

    .submit-btn {
      width: 100%;
      background: #C22126;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      
      &:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
    }
  }
}

// Prevent body scroll when modal is open
body.mobile-create-modal-open {
  overflow: hidden !important;
}

// Dark mode support
body.dark .CustomMobileCreateModal {
  background: #2d2d2d;

  &-header {
    background: #3d3d3d;
    border-bottom-color: #555;

    h2 {
      color: #fff;
    }

    .close-btn {
      color: #ccc;
      
      &:hover {
        background: rgba(255, 255, 255, 0.1);
      }
    }
  }

  &-content {
    .form-group {
      label {
        color: #fff;
      }

      input, select, textarea {
        background: #3d3d3d !important;
        color: #fff !important;
        border-color: #555 !important;

        &:focus {
          border-color: #C22126 !important;
          box-shadow: 0 0 0 2px rgba(194, 33, 38, 0.2) !important;
        }
        
        &::placeholder {
          color: #aaa !important;
        }
      }
      
      select {
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e") !important;
      }
      
      .TextEditor-container {
        border-color: #555 !important;
        
        &:focus-within {
          border-color: #C22126 !important;
          box-shadow: 0 0 0 2px rgba(194, 33, 38, 0.2) !important;
        }
        
        .TextEditor {
          &-editor {
            background: #3d3d3d !important;
            color: #fff !important;
          }
          
          &-toolbar {
            background: #2d2d2d !important;
            border-color: #555 !important;
            
            &.TextEditor-toolbar--mobile-direct {
              .Button--direct-upload {
                background: #C22126 !important;
                color: white !important;
                
                &:hover {
                  background: darken(#C22126, 15%) !important;
                }
              }
            }
          }
        }
      }
    }
  }

  &-footer {
    background: #3d3d3d;
    border-top-color: #555;
  }
}