<<<<<<< HEAD
{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@vietvan-ca/flarum-themes/webpack/bootstrap","webpack://@vietvan-ca/flarum-themes/webpack/runtime/compat get default export","webpack://@vietvan-ca/flarum-themes/webpack/runtime/define property getters","webpack://@vietvan-ca/flarum-themes/webpack/runtime/hasOwnProperty shorthand","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/app']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/extend']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/HeaderPrimary']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/HeaderSecondary']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@vietvan-ca/flarum-themes/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@vietvan-ca/flarum-themes/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/Navigation']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/Component']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/Link']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@vietvan-ca/flarum-themes/./src/forum/components/TopicColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ReplyColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ViewColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/utils/discussionHelpers.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ActivityColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/LastUsersColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomDiscussionRow.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/DiscussionListHeader.js","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/Search']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/Button']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/SelectDropdown']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomMobileDiscussionToolbar.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/HeroSection.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/Logo.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomDiscussionTabNavigation.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomMobileDrawer.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ToolbarCleanup.js","webpack://@vietvan-ca/flarum-themes/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderPrimary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Navigation'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Link from 'flarum/common/components/Link';\r\nimport icon from 'flarum/common/helpers/icon';\r\n\r\n/**\r\n * Renders the topic column with title, tags, and excerpt\r\n */\r\nexport default class TopicColumn extends Component {\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n    const firstPost = discussion.firstPost();\r\n    const tags = discussion.tags() || [];\r\n    \r\n    // Get sticky and locked status\r\n    const isSticky = discussion.isSticky();\r\n    const isLocked = discussion.isLocked();\r\n    \r\n    return m('div.discussion-topic', [\r\n      m('div.discussion-badges', [\r\n        // Display sticky and locked badges if applicable\r\n        isSticky ? m('span.Badge.Badge--sticky', [\r\n          icon('fas fa-thumbtack')\r\n        ]) : null,\r\n        isLocked ? m('span.Badge.Badge--locked', [\r\n          icon('fas fa-lock'),\r\n        ]) : null,\r\n      ]),\r\n      m('div.discussion-title', [\r\n        m(Link, { \r\n          href: app.route.discussion(discussion) \r\n        }, discussion.title())\r\n      ]),\r\n      m('div.discussion-tags', [\r\n        tags.map(tag => m('span.discussion-tag', { \r\n          className: tag.color() ? 'colored' : '',\r\n          style: tag.color() ? { backgroundColor: tag.color() } : {}\r\n        }, tag.name())),\r\n      ]),\r\n      app.forum.attribute('custom-discussion-list.enable_excerpts') !== false ? \r\n        m('div.discussion-excerpt', firstPost?.contentPlain() || '') : null\r\n    ]);\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\n\r\n/**\r\n * Renders the reply count column\r\n */\r\nexport default class ReplyColumn extends Component {\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n    const replyCount = discussion.replyCount() ?? 0;\r\n\r\n    return m('div.discussion-reply', [\r\n      m('span', replyCount),\r\n    ]);\r\n  }\r\n}\r\n","import Component from 'flarum/common/Component';\r\n\r\n/**\r\n * Renders the view count column\r\n */\r\nexport default class ViewColumn extends Component {\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n    const viewCount = discussion.attribute('views') || 0;\r\n    \r\n    return m('div.discussion-view', [\r\n      m('span', viewCount)\r\n    ]);\r\n  }\r\n}","/**\r\n * Helper function to calculate time since in days\r\n */\r\nexport function getTimeSince(date) {\r\n  if (!date) return '-';\r\n\r\n  // Convert to Date object if string\r\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\r\n\r\n  // Check if date is valid\r\n  if (isNaN(dateObj.getTime())) return '-';\r\n\r\n  const now = new Date();\r\n  const diffTime = now - dateObj;\r\n\r\n  // If time is in the future, return placeholder\r\n  if (diffTime < 0) return '-';\r\n\r\n  // Calculate time differences\r\n  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\r\n  const diffHours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\r\n  const diffMinutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n  // Return only the largest time unit\r\n  if (diffDays >= 30) {\r\n    // More than a month, show months\r\n    const diffMonths = Math.floor(diffDays / 30);\r\n    return diffMonths + 'mo';\r\n  }\r\n\r\n  if (diffDays > 0) {\r\n    return diffDays + 'd';\r\n  }\r\n\r\n  if (diffHours > 0) {\r\n    return diffHours + 'h';\r\n  }\r\n\r\n  if (diffMinutes > 0) {\r\n    return diffMinutes + 'm';\r\n  }\r\n\r\n  // If less than a minute\r\n  return 'now';\r\n}\r\n\r\n/**\r\n * Helper function to get user initials\r\n */\r\nexport function getInitials(username) {\r\n  if (!username) return '';\r\n  return username.charAt(0).toUpperCase();\r\n}\r\n\r\n/**\r\n * Helper function to get color class based on index\r\n */\r\nexport function getColorClass(index) {\r\n  const colorClasses = ['color-1', 'color-2', 'color-3', 'color-4', 'color-5'];\r\n  return colorClasses[index % colorClasses.length];\r\n}\r\n\r\n/**\r\n * Renders user avatar with either image or initials\r\n */\r\nexport function renderUserAvatar(user, index) {\r\n  if (!user) return null;\r\n\r\n  const userName = user.username || '';\r\n  const avatarUrl = user.avatar_url;\r\n\r\n  if (avatarUrl) {\r\n    // If avatar URL exists, render the image\r\n    return m(\r\n      'span.user-avatar',\r\n      { title: userName },\r\n      m('img.avatar-image', {\r\n        src: avatarUrl,\r\n        alt: userName,\r\n      })\r\n    );\r\n  } else {\r\n    // If no avatar URL, show initials with color background\r\n    return m(\r\n      'span.user-avatar',\r\n      { title: userName },\r\n      m(\r\n        'span.user-initial',\r\n        {\r\n          className: getColorClass(index),\r\n        },\r\n        getInitials(userName)\r\n      )\r\n    );\r\n  }\r\n}\r\n","import Component from 'flarum/common/Component';\r\nimport { getTimeSince } from '../utils/discussionHelpers';\r\n\r\n/**\r\n * Renders the activity column with time since last post and active users\r\n */\r\nexport default class ActivityColumn extends Component {\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n    const lastPostedAt = discussion.lastPostedAt();\r\n    const timeSince = lastPostedAt ? getTimeSince(new Date(lastPostedAt)) : '';\r\n\r\n    return m('div.discussion-activity', [m('span', timeSince)]);\r\n  }\r\n}\r\n","import Component from 'flarum/common/Component';\r\nimport { renderUserAvatar } from '../utils/discussionHelpers';\r\n\r\n/**\r\n * Renders the activity column with time since last post and active users\r\n */\r\nexport default class LastUsersColumn extends Component {\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n    const latestPosters = discussion.attribute('latestPosters') || [];\r\n    \r\n    return m('div.discussion-users', [\r\n      m('div.active-users', latestPosters.slice(0, 5).map((user, i) => \r\n        renderUserAvatar(user, i)\r\n      ))\r\n    ]);\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\nimport Link from 'flarum/common/components/Link';\r\nimport TopicColumn from './TopicColumn';\r\nimport ReplyColumn from './ReplyColumn';\r\nimport ViewColumn from './ViewColumn';\r\nimport ActivityColumn from './ActivityColumn';\r\nimport LastUsersColumn from './LastUsersColumn';\r\n\r\n/**\r\n * The main row component for discussions in the discussion list\r\n */\r\nexport default class CustomDiscussionRow extends Component {\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n\r\n    return m(Link, {\r\n      className: 'discussion-row',\r\n      href: app.route.discussion(discussion),\r\n    }, [\r\n      m(TopicColumn, { discussion }),\r\n      m(LastUsersColumn, { discussion }),\r\n      m(ReplyColumn, { discussion }),\r\n      m(ViewColumn, { discussion }),\r\n      m(ActivityColumn, { discussion }),\r\n    ]);\r\n  }\r\n}\r\n","import Component from 'flarum/common/Component';\r\nimport app from 'flarum/forum/app';\r\n\r\n\r\n/**\r\n * Renders the header for the discussion list\r\n */\r\n\r\nexport default class DiscussionListHeader extends Component {\r\n  view() {\r\n    return (\r\n      <li className=\"CustomDiscussionList-header\">\r\n        <div className=\"DiscussionListItem-info topic\">\r\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.topic')}\r\n        </div>\r\n        <div className=\"DiscussionListItem-info replies\">\r\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.replies')}\r\n        </div>\r\n        <div className=\"DiscussionListItem-info views\">\r\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.views')}\r\n        </div>\r\n        <div className=\"DiscussionListItem-info activity\">\r\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.activity')}\r\n        </div>\r\n      </li>\r\n    );\r\n  }\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Search'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/SelectDropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","import Component from 'flarum/common/Component';\r\nimport app from 'flarum/forum/app';\r\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\r\nimport LogInModal from 'flarum/forum/components/LogInModal';\r\nimport LinkButton from 'flarum/common/components/LinkButton';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport Button from 'flarum/common/components/Button';\r\nimport SelectDropdown from 'flarum/common/components/SelectDropdown';\r\nimport listItems from 'flarum/common/helpers/listItems';\r\n\r\nexport default class CustomMobileDiscussionToolbar extends Component {\r\n  view() {\r\n    return (\r\n      <div className=\"CustomMobileDiscussionToolbar\">\r\n        {/* Toggle Discussion List Button */}\r\n        <div className=\"CustomMobileDiscussionToolbar-left\">\r\n          <span className=\"CustomMobileDiscussionToolbar-date\">{this.currentDate}</span>\r\n          {SelectDropdown.component(\r\n            {\r\n              buttonClassName: 'Button Button--text',\r\n              className: 'all-discussion-select',\r\n            },\r\n            this.getNavigationItems().toArray()\r\n          )}\r\n        </div>\r\n\r\n        {/* Start Discussion Button */}\r\n        <button\r\n          class=\"Button Button--primary CustomMobileDiscussionToolbar-button\"\r\n          type=\"button\"\r\n          aria-label=\"Start Discussion\"\r\n          onclick={() => this.newDiscussionAction()}\r\n        >\r\n          <i aria-hidden=\"true\" class=\"icon fas fa-edit Button-icon\"></i>\r\n          <span class=\"Button-label\">\r\n            {app.translator.trans('core.forum.index.start_discussion_button')}\r\n          </span>\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getNavigationItems() {\r\n    const items = new ItemList();\r\n\r\n    // All Discussions\r\n    items.add(\r\n      'all-discussions',\r\n      LinkButton.component(\r\n        {\r\n          href: app.route('index'),\r\n          icon: 'fas fa-comments',\r\n        },\r\n        app.translator.trans('core.forum.index.all_discussions_link')\r\n      ),\r\n      100\r\n    );\r\n\r\n    // Tags\r\n    items.add(\r\n      'tags',\r\n      LinkButton.component(\r\n        {\r\n          href: app.route('tags'),\r\n          icon: 'fas fa-th-large',\r\n        },\r\n        app.translator.trans('flarum-tags.forum.index.tags_link')\r\n      ),\r\n      90\r\n    );\r\n\r\n    // Get all tags from the store\r\n    const allTags = app.store.all('tags');\r\n\r\n    if (allTags && allTags.length > 0) {\r\n      // Filter and sort primary tags\r\n      const primaryTags = allTags\r\n        .filter((tag) => {\r\n          // Only show primary tags (no parent)\r\n          const hasParent = tag.parent && tag.parent();\r\n          const position = tag.position();\r\n          // Include tags that don't have a parent and have a position\r\n          return !hasParent && position !== null && position !== undefined;\r\n        })\r\n        .sort((a, b) => a.position() - b.position());\r\n\r\n      // Add each tag to the dropdown\r\n      primaryTags.forEach((tag, index) => {\r\n        items.add(\r\n          `tag-${tag.id()}`,\r\n          LinkButton.component(\r\n            {\r\n              href: app.route('tag', { tags: tag.slug() }),\r\n              icon: 'fas fa-circle',\r\n              style: tag.color() ? { color: tag.color() } : {},\r\n            },\r\n            tag.name()\r\n          ),\r\n          80 - index\r\n        );\r\n      });\r\n    }\r\n\r\n    return items;\r\n  }\r\n\r\n  newDiscussionAction() {\r\n    return new Promise((resolve, reject) => {\r\n      if (app.session.user) {\r\n        app.composer.load(DiscussionComposer, { user: app.session.user });\r\n        app.composer.show();\r\n\r\n        return resolve(app.composer);\r\n      } else {\r\n        app.modal.show(LogInModal);\r\n\r\n        return reject();\r\n      }\r\n    });\r\n  }\r\n}\r\n","import Component from 'flarum/common/Component';\r\nimport Search from 'flarum/forum/components/Search';\r\nimport CustomMobileDiscussionToolbar from './CustomMobileDiscussionToolbar';\r\n\r\nexport default class HeroSection extends Component {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    const forum = app.forum;\r\n    // enabled?\r\n    this.enabled = forum.attribute('vietvan_ca_hero_enabled') === '1';\r\n    if (!this.enabled) return;\r\n\r\n    // Initial mode - start with light as default\r\n    this.mode = 'light';\r\n\r\n    // Setup listeners first\r\n    if (flarum.extensions['fof-nightmode']) {\r\n      this.setupNightModeListener();\r\n    }\r\n    this.setupSystemModeListener();\r\n    this.setupBodyClassObserver();\r\n\r\n    // Compute actual mode after a delay to ensure theme has initialized\r\n    setTimeout(() => {\r\n      this.mode = this.computeMode();\r\n      m.redraw();\r\n    }, 100);\r\n\r\n    // Re-check mode after a longer delay (in case FoF extension hasn't initialized yet)\r\n    setTimeout(() => {\r\n      const newMode = this.computeMode();\r\n      if (newMode !== this.mode) {\r\n        this.mode = newMode;\r\n        m.redraw();\r\n      }\r\n    }, 500);\r\n\r\n    // locale-specific text\r\n    this.locale = app.translator.getLocale() || 'en';\r\n    const titleKey = `vietvan_ca_hero_title_${this.locale}`;\r\n    const descKey = `vietvan_ca_hero_description_${this.locale}`;\r\n\r\n    this.title = forum.attribute(titleKey) ?? app.translator.trans('vietvan-ca-flarum-themes.forum.hero.title');\r\n    this.description = forum.attribute(descKey) ?? app.translator.trans('vietvan-ca-flarum-themes.forum.hero.description');\r\n\r\n    // show or hide text overlay?\r\n    this.showText = forum.attribute('vietvan_ca_hero_show_text') === '1';\r\n\r\n    // has custom text color?\r\n    this.hasCustomColor = forum.attribute('vietvan_ca_hero_custom_color_enabled') === '1';\r\n    this.titleStyle = {};\r\n    this.descriptionStyle = {};\r\n\r\n    if (this.hasCustomColor) {\r\n      const titleColor = forum.attribute('vietvan_ca_hero_title_color') || '#ffffff';\r\n      const subtitleColor = forum.attribute('vietvan_ca_hero_subtitle_color') || '#ffffff';\r\n\r\n      this.titleStyle = { color: titleColor };\r\n      this.descriptionStyle = { color: subtitleColor };\r\n    }\r\n  }\r\n\r\n  computeMode() {\r\n    // First, check if FoF Night Mode is active by checking the body class\r\n    // This is the most reliable way to detect actual dark mode state\r\n    if (document.body.classList.contains('flarum--night')) {\r\n      return 'dark';\r\n    }\r\n\r\n    // Check if user is logged in\r\n    const user = app.session.user;\r\n\r\n    if (user) {\r\n      // Logged in: use user preference from FoF Night Mode\r\n      // Safely access preferences with optional chaining\r\n      const pref = user.preferences?.().fofNightMode;\r\n      // FoF Night Mode stores as integers: 0 = auto, 1 = light, 2 = dark\r\n      if (pref === 2 || pref === '2') return 'dark';\r\n      if (pref === 1 || pref === '1') return 'light';\r\n      if (pref === 0 || pref === '0' || pref === null || pref === undefined) {\r\n        // For auto/null preferences, default to light mode (respecting our default theme setting)\r\n        // Only use system preference if user explicitly wants auto mode\r\n        const isExplicitAuto = pref === 0 || pref === '0';\r\n        if (isExplicitAuto) {\r\n          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n        }\r\n        // Default to light for null/undefined (new users)\r\n        return 'light';\r\n      }\r\n      return 'light';\r\n    }\r\n\r\n    // Guest: check cookie\r\n    const cookieValue = document.cookie\r\n      .split('; ')\r\n      .find((row) => row.startsWith('flarum_nightmode='))\r\n      ?.split('=')[1];\r\n\r\n    if (cookieValue === '2') return 'dark';\r\n    if (cookieValue === '1') return 'light';\r\n    if (cookieValue === '0') {\r\n      // Explicit system preference\r\n      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n    }\r\n    \r\n    // No cookie found - default to light mode (respecting our default theme setting)\r\n    return 'light';\r\n  }\r\n\r\n  setupNightModeListener() {\r\n    this.nightModeHandler = (event) => {\r\n      this.mode = event.detail === 'day' ? 'light' : 'dark';\r\n      m.redraw();\r\n    };\r\n    document.addEventListener('fofnightmodechange', this.nightModeHandler);\r\n  }\r\n\r\n  setupSystemModeListener() {\r\n    // Listen to OS-level dark mode changes\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n    this.systemModeHandler = (e) => {\r\n      const newMode = this.computeMode();\r\n      if (newMode !== this.mode) {\r\n        this.mode = newMode;\r\n        m.redraw();\r\n      }\r\n    };\r\n    mediaQuery.addEventListener('change', this.systemModeHandler);\r\n  }\r\n\r\n  setupBodyClassObserver() {\r\n    // Watch for changes to body class (when FoF Night Mode toggles)\r\n    this.bodyObserver = new MutationObserver(() => {\r\n      const newMode = this.computeMode();\r\n      if (newMode !== this.mode) {\r\n        this.mode = newMode;\r\n        m.redraw();\r\n      }\r\n    });\r\n\r\n    this.bodyObserver.observe(document.body, {\r\n      attributes: true,\r\n      attributeFilter: ['class'],\r\n    });\r\n  }\r\n\r\n  onremove() {\r\n    // Clean up listeners\r\n    if (this.nightModeHandler) {\r\n      document.removeEventListener('fofnightmodechange', this.nightModeHandler);\r\n    }\r\n    if (this.systemModeHandler) {\r\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n      mediaQuery.removeEventListener('change', this.systemModeHandler);\r\n    }\r\n    if (this.bodyObserver) {\r\n      this.bodyObserver.disconnect();\r\n    }\r\n  }\r\n\r\n  getBackgroundStyle() {\r\n    const forum = app.forum;\r\n    const bgAttr = this.mode === 'dark' ? 'vietvan_ca_hero_background_image_darkUrl' : 'vietvan_ca_hero_background_imageUrl';\r\n    const bgUrl = forum.attribute(bgAttr);\r\n\r\n    return bgUrl\r\n      ? {\r\n          height: '35vh',\r\n          backgroundImage: `url(${bgUrl})`,\r\n          backgroundPosition: 'center',\r\n          backgroundSize: 'cover',\r\n          backgroundRepeat: 'no-repeat',\r\n        }\r\n      : undefined;\r\n  }\r\n\r\n  view() {\r\n    // Don't render if not enabled\r\n    if (!this.enabled) return null;\r\n\r\n    // Only show on the homepage (root path)\r\n    const currentPath = window.location.pathname;\r\n    if (currentPath !== '/' && currentPath !== '') return null;\r\n\r\n    // Get background style dynamically on each render\r\n    const backgroundStyle = this.getBackgroundStyle();\r\n\r\n    return (\r\n      <div className=\"HeroSection\" style={backgroundStyle}>\r\n        {this.showText && (\r\n          <div className=\"container\">\r\n            <h1 className=\"HeroSection-title\" style={this.titleStyle}>\r\n              {this.title}\r\n            </h1>\r\n            <p className=\"HeroSection-subtitle\" style={this.descriptionStyle}>\r\n              {this.description}\r\n            </p>\r\n          </div>\r\n        )}\r\n        <div className=\"container\">\r\n          <Search state={app.search} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\n\r\nexport default class Logo extends Component {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n    // Safely check user preferences with optional chaining on both user and preferences method\r\n    this.mode = app.session.user?.preferences?.().fofNightMode === 2 ? 'dark' : 'light';\r\n    \r\n    if (flarum.extensions['fof-nightmode']) {\r\n      this.setupNightModeListener();\r\n    }\r\n  }\r\n\r\n  setupNightModeListener() {\r\n    document.addEventListener('fofnightmodechange', (event) => {\r\n      this.mode = event.detail === 'day' ? 'light' : 'dark';\r\n      m.redraw();\r\n    });\r\n  }\r\n\r\n  view(vnode) {\r\n    const logoAttr = this.mode === 'dark' ? 'vietvan_ca_logo_darkUrl' : 'vietvan_ca_logoUrl';\r\n    const logoUrl = app.forum.attribute(logoAttr);\r\n\r\n    if (!logoUrl) return null;\r\n\r\n    const customUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || app.route('index');\r\n    const imageStyle = vnode.attrs.imageStyle || {};\r\n\r\n    return (\r\n      <a href={customUrl} className=\"Header-logo CustomHeaderLogo\">\r\n        <img src={logoUrl} alt={'VietVan CA'} style={imageStyle} />\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","import Component from 'flarum/common/Component';\r\nimport LinkButton from 'flarum/common/components/LinkButton';\r\nimport app from 'flarum/forum/app';\r\n\r\nexport default class CustomDiscussionTabNavigation extends Component {\r\n  view() {\r\n    const currentSort = app.search.params()?.sort;\r\n\r\n    const tabs = [\r\n      { key: 'latest', label: app.translator.trans('core.forum.index_sort.latest_button'), sortParam: '', default: true },\r\n      { key: 'top', label: app.translator.trans('core.forum.index_sort.top_button'), sortParam: 'top' },\r\n      { key: 'newest', label: app.translator.trans('core.forum.index_sort.newest_button'), sortParam: 'newest' },\r\n      { key: 'oldest', label: app.translator.trans('core.forum.index_sort.oldest_button'), sortParam: 'oldest' },\r\n    ];\r\n\r\n    return (\r\n      <div className=\"CustomDiscussionTabNavigation\">\r\n        {tabs.map((tab) => {\r\n          let isActive = false;\r\n          if (tab.routeName) {\r\n            isActive = app.current.matches(tab.routeName);\r\n          } else if (tab.isFilter) {\r\n            isActive = app.search.params.q && app.search.params.q.includes(tab.filterParam);\r\n          } else {\r\n            isActive = currentSort === tab.sortParam || (!currentSort && tab.default);\r\n          }\r\n\r\n          return (\r\n            <LinkButton className={`SortItem Button Button--link ${isActive ? 'active' : ''}`} onclick={() => this.navigateTo(tab)}>\r\n              {tab.label}\r\n            </LinkButton>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  navigateTo(tab) {\r\n    // 1. Get the current URL path (e.g., /t/general?sort=newest)\r\n    const currentPath = m.route.get();\r\n\r\n    // 2. Remove any existing query parameters by splitting the string at the '?'\r\n    const basePath = currentPath.split('?')[0]; // Result: /t/general\r\n\r\n    // 3. Build the new URL path string\r\n    let newPath = basePath;\r\n    if (!tab.default) {\r\n      // Add the sort parameter if this tab is not the default one\r\n      newPath += '?sort=' + tab.sortParam;\r\n    }\r\n\r\n    // 4. Use m.route.set() to navigate to the new URL without a full page reload\r\n    m.route.set(newPath);\r\n  }\r\n}\r\n","import app from 'flarum/forum/app';\r\nimport Component from 'flarum/common/Component';\r\nimport ItemList from 'flarum/common/utils/ItemList';\r\nimport listItems from 'flarum/common/helpers/listItems';\r\nimport LogInModal from 'flarum/forum/components/LogInModal';\r\nimport Logo from './Logo';\r\n\r\n/**\r\n * Helper to get translation with fallback\r\n */\r\nfunction trans(key, fallback) {\r\n  const result = app.translator.trans(`vietvan-ca-flarum-themes.forum.mobile_drawer.${key}`);\r\n  if (result && result !== `vietvan-ca-flarum-themes.forum.mobile_drawer.${key}`) {\r\n    return result;\r\n  }\r\n  return fallback;\r\n}\r\n\r\n/**\r\n * Custom Mobile Drawer component that matches VietVan main website sidebar\r\n */\r\nexport default class CustomMobileDrawer extends Component {\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n  }\r\n\r\n  view() {\r\n    return (\r\n      <div>\r\n        {/* Toggle Button - Always visible, positioned outside drawer */}\r\n        <button \r\n          className=\"CustomMobileDrawer-toggleBtn\"\r\n          onclick={() => this.toggleDrawer()}\r\n        >\r\n          <i className=\"fas fa-bars\"></i>\r\n        </button>\r\n\r\n        <div className=\"CustomMobileDrawer\">\r\n          {/* Logo Section */}\r\n          <div className=\"CustomMobileDrawer-logo\">\r\n            <Logo imageStyle={{ height: '40px' }} />\r\n          </div>\r\n\r\n          {/* Navigation Menu */}\r\n          <nav className=\"CustomMobileDrawer-nav\">\r\n            <ul className=\"CustomMobileDrawer-menu\">\r\n              {listItems(this.menuItems().toArray())}\r\n            </ul>\r\n          </nav>\r\n\r\n          {/* Separator */}\r\n          <div className=\"CustomMobileDrawer-separator\"></div>\r\n\r\n          {/* Auth Section */}\r\n          <div className=\"CustomMobileDrawer-auth\">\r\n            {app.session.user ? this.loggedInSection() : this.guestSection()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Build menu items for navigation\r\n   */\r\n  menuItems() {\r\n    const items = new ItemList();\r\n    const mainSiteUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || app.forum.attribute('baseUrl').replace('/forum', '');\r\n\r\n    // Trang Ch (Home)\r\n    items.add('home',\r\n      <li className=\"CustomMobileDrawer-menuItem\">\r\n        <a href={mainSiteUrl} className=\"CustomMobileDrawer-link\">\r\n          {trans('home', 'Trang Ch')}\r\n        </a>\r\n      </li>,\r\n      100\r\n    );\r\n\r\n    // Din n (Forum) - Active\r\n    items.add('forum',\r\n      <li className=\"CustomMobileDrawer-menuItem active\">\r\n        <a href={app.forum.attribute('baseUrl')} className=\"CustomMobileDrawer-link\">\r\n          {trans('forum', 'Din n')}\r\n        </a>\r\n      </li>,\r\n      90\r\n    );\r\n\r\n    // Lu  (Notes/Guidelines)\r\n    const guidelinesTag = this.findTagBySlug('luu-y') || this.findTagBySlug('guidelines');\r\n    if (guidelinesTag) {\r\n      items.add('guidelines',\r\n        <li className=\"CustomMobileDrawer-menuItem\">\r\n          <a href={app.route('tag', { tags: guidelinesTag.slug() })} className=\"CustomMobileDrawer-link\">\r\n            {trans('guidelines', 'Lu ')}\r\n          </a>\r\n        </li>,\r\n        80\r\n      );\r\n    }\r\n\r\n    // Language Selector\r\n    items.add('language',\r\n      <li className=\"CustomMobileDrawer-menuItem CustomMobileDrawer-menuItem--dropdown\">\r\n        {this.languageDropdown()}\r\n      </li>,\r\n      70\r\n    );\r\n\r\n    // Theme/Appearance Toggle\r\n    items.add('theme',\r\n      <li className=\"CustomMobileDrawer-menuItem CustomMobileDrawer-menuItem--dropdown\">\r\n        {this.themeToggle()}\r\n      </li>,\r\n      60\r\n    );\r\n\r\n    return items;\r\n  }\r\n\r\n  /**\r\n   * Find a tag by its slug\r\n   */\r\n  findTagBySlug(slug) {\r\n    if (!app.store || !app.store.all) return null;\r\n    \r\n    const tags = app.store.all('tags');\r\n    return tags.find(tag => tag.slug() === slug);\r\n  }\r\n\r\n  /**\r\n   * Language dropdown selector\r\n   */\r\n  languageDropdown() {\r\n    // Check if fof/linguist or flarum/lang-ext is available\r\n    const locales = app.data.locales || {};\r\n    const currentLocale = app.data.locale || 'en';\r\n    \r\n    if (Object.keys(locales).length <= 1) {\r\n      // Only one locale, just show current language\r\n      return (\r\n        <div className=\"CustomMobileDrawer-languageDisplay\">\r\n          <span className=\"CustomMobileDrawer-link\">\r\n            {this.getLocaleName(currentLocale)}\r\n            <i className=\"fas fa-globe CustomMobileDrawer-icon\"></i>\r\n          </span>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"CustomMobileDrawer-dropdown\">\r\n        <button \r\n          className=\"CustomMobileDrawer-link CustomMobileDrawer-dropdownTrigger\"\r\n          onclick={(e) => this.toggleDropdown(e, 'language')}\r\n        >\r\n          {this.getLocaleName(currentLocale)}\r\n          <i className=\"fas fa-chevron-down CustomMobileDrawer-chevron\"></i>\r\n        </button>\r\n        <ul className=\"CustomMobileDrawer-dropdownMenu\" id=\"language-dropdown\">\r\n          {Object.keys(locales).map(locale => (\r\n            <li key={locale}>\r\n              <a \r\n                href=\"javascript:void(0)\" \r\n                onclick={() => this.changeLocale(locale)}\r\n                className={currentLocale === locale ? 'active' : ''}\r\n              >\r\n                {locales[locale]}\r\n              </a>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get locale display name\r\n   */\r\n  getLocaleName(locale) {\r\n    const names = {\r\n      'en': 'English',\r\n      'vi': 'Ting Vit'\r\n    };\r\n    return names[locale] || app.data.locales?.[locale] || locale;\r\n  }\r\n\r\n  /**\r\n   * Change locale\r\n   */\r\n  changeLocale(locale) {\r\n    if (app.session.user) {\r\n      app.session.user.savePreferences({ locale }).then(() => {\r\n        window.location.reload();\r\n      });\r\n    } else {\r\n      document.cookie = `locale=${locale};path=/;max-age=${60 * 60 * 24 * 365}`;\r\n      window.location.reload();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Theme toggle button\r\n   */\r\n  themeToggle() {\r\n    return (\r\n      <button \r\n        className=\"CustomMobileDrawer-link\"\r\n        onclick={() => this.toggleTheme()}\r\n      >\r\n        <i className=\"fas fa-cog CustomMobileDrawer-icon--left\"></i>\r\n        {trans('appearance', 'Giao Din')}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Toggle theme (if night mode extension is available)\r\n   */\r\n  toggleTheme() {\r\n    // Try to trigger FoF NightMode\r\n    const nightModeToggle = document.querySelector('.item-nightMode button, .NightMode-toggle');\r\n    if (nightModeToggle) {\r\n      nightModeToggle.click();\r\n    } else {\r\n      // Fallback: toggle dark class on body\r\n      document.body.classList.toggle('dark');\r\n      const isDark = document.body.classList.contains('dark');\r\n      localStorage.setItem('fofNightMode', isDark ? 'dark' : 'light');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle dropdown visibility\r\n   */\r\n  toggleDropdown(e, dropdownId) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n    const dropdown = document.getElementById(`${dropdownId}-dropdown`);\r\n    if (dropdown) {\r\n      dropdown.classList.toggle('open');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Guest section with login/register buttons and social login\r\n   */\r\n  guestSection() {\r\n    const mainSiteUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || '';\r\n    const baseMainUrl = mainSiteUrl ? mainSiteUrl.replace('/forum', '').replace(/\\/$/, '') : '';\r\n    \r\n    // Use external register URL but Flarum login for SSO\r\n    const registerUrl = `${baseMainUrl}/auth/register`;\r\n\r\n    return (\r\n      <div className=\"CustomMobileDrawer-guest\">\r\n        {/* Register Button */}\r\n        <a href={registerUrl} className=\"Button Button--primary CustomMobileDrawer-registerBtn\">\r\n          {trans('register', 'ng k')}\r\n        </a>\r\n\r\n        {/* Login Button - Use Flarum's default login (SSO compatible) */}\r\n        <button \r\n          className=\"Button Button--secondary CustomMobileDrawer-loginBtn\"\r\n          onclick={() => this.showLoginModal()}\r\n        >\r\n          {trans('login', 'ng nhp')}\r\n        </button>\r\n\r\n        {/* Social Login Separator */}\r\n        <div className=\"CustomMobileDrawer-socialSeparator\">\r\n          <span>{trans('or', 'Hoc:')}</span>\r\n        </div>\r\n\r\n        {/* Social Login Buttons */}\r\n        <div className=\"CustomMobileDrawer-socialButtons\">\r\n          <button \r\n            className=\"Button CustomMobileDrawer-socialBtn CustomMobileDrawer-socialBtn--facebook\"\r\n            onclick={() => this.socialLogin('facebook')}\r\n          >\r\n            <i className=\"fab fa-facebook CustomMobileDrawer-socialIcon\"></i>\r\n            {trans('login_facebook', 'ng nhp bng Facebook')}\r\n          </button>\r\n\r\n          <button \r\n            className=\"Button CustomMobileDrawer-socialBtn CustomMobileDrawer-socialBtn--google\"\r\n            onclick={() => this.socialLogin('google')}\r\n          >\r\n            <img src=\"https://www.google.com/favicon.ico\" alt=\"Google\" className=\"CustomMobileDrawer-socialIcon CustomMobileDrawer-socialIcon--img\" />\r\n            {trans('login_google', 'ng nhp bng Google')}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle social login with dual-platform authentication\r\n   * Uses popup window for OAuth flow\r\n   */\r\n  socialLogin(provider) {\r\n    // Get backend API URL from Flarum settings or use default\r\n    const backendUrl = app.forum.attribute('jwt-sso.backendApiUrl') || 'https://api.vietvan.ca';\r\n    \r\n    if (!backendUrl) {\r\n      console.error('Backend API URL not configured for social login');\r\n      alert('Social login is not properly configured. Please contact the administrator.');\r\n      return;\r\n    }\r\n\r\n    // Close the mobile drawer first\r\n    const drawer = document.querySelector('.vietvan-mobile-drawer');\r\n    if (drawer) {\r\n      drawer.style.right = '-100%';\r\n      document.body.classList.remove('vietvan-drawer-open');\r\n    }\r\n\r\n    // Generate state parameter for security\r\n    const state = this.generateRandomString(32);\r\n\r\n    // Build the OAuth URL - backend will handle the redirect to Google\r\n    const returnUrl = encodeURIComponent(`${window.location.origin}/auth/sso/callback`);\r\n    const oauthUrl = `${backendUrl}/api/flarum-auth/${provider}?return_url=${returnUrl}&state=${state}`;\r\n    \r\n    console.log('Starting dual-platform OAuth flow:', oauthUrl);\r\n    \r\n    // Open popup window for OAuth\r\n    const popup = window.open(\r\n      oauthUrl,\r\n      `${provider}_login`,\r\n      'width=500,height=600,scrollbars=yes,resizable=yes,left=' + (screen.width / 2 - 250) + ',top=' + (screen.height / 2 - 300)\r\n    );\r\n\r\n    if (!popup) {\r\n      alert('Popup b chn. Vui lng cho php popup v th li.');\r\n      return;\r\n    }\r\n\r\n    // Focus the popup\r\n    popup.focus();\r\n  }\r\n\r\n  /**\r\n   * Logged in user section with enhanced identity display\r\n   */\r\n  loggedInSection() {\r\n    const user = app.session.user;\r\n    const mainSiteUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || '';\r\n    const baseMainUrl = mainSiteUrl ? mainSiteUrl.replace('/forum', '').replace(/\\/$/, '') : '';\r\n\r\n    return (\r\n      <div className=\"CustomMobileDrawer-user\">\r\n        {/* Enhanced User Identity Section */}\r\n        <div className=\"CustomMobileDrawer-userIdentity\">\r\n          <div className=\"CustomMobileDrawer-avatar CustomMobileDrawer-avatar--default\">\r\n            {user.avatarUrl() ? (\r\n              <img src={user.avatarUrl()} alt={user.displayName()} />\r\n            ) : (\r\n              <i className=\"fas fa-user\"></i>\r\n            )}\r\n          </div>\r\n          <div className=\"CustomMobileDrawer-userName\">\r\n            <span className=\"CustomMobileDrawer-displayName\">{user.displayName()}</span>\r\n            <a href={app.route('settings')} className=\"CustomMobileDrawer-accountSettingsBtn\">\r\n              {trans('account_settings', 'Ci t ti khon')}\r\n            </a>\r\n          </div>\r\n        </div>\r\n\r\n        {/* User Menu - Updated with requested items */}\r\n        <ul className=\"CustomMobileDrawer-userMenu\">\r\n          <li>\r\n            <a href={`${baseMainUrl}/manage-listings/posts/create`} className=\"CustomMobileDrawer-link\">\r\n              <i className=\"fas fa-edit CustomMobileDrawer-icon--left\"></i>\r\n              {trans('create_post', 'ng tin')}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a href={`${baseMainUrl}/manage-listings`} className=\"CustomMobileDrawer-link\">\r\n              <i className=\"fas fa-list-alt CustomMobileDrawer-icon--left\"></i>\r\n              {trans('manage_posts', 'Qun l tin ng')}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <a href={`${baseMainUrl}/contact`} className=\"CustomMobileDrawer-link\">\r\n              <i className=\"fas fa-envelope CustomMobileDrawer-icon--left\"></i>\r\n              {trans('contact', 'Lin H')}\r\n            </a>\r\n          </li>\r\n          <li>\r\n            <button \r\n              className=\"CustomMobileDrawer-link CustomMobileDrawer-logout\"\r\n              onclick={() => this.logout()}\r\n            >\r\n              <i className=\"fas fa-sign-out-alt CustomMobileDrawer-icon--left\"></i>\r\n              {trans('logout', 'ng xut')}\r\n            </button>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Toggle the mobile drawer visibility\r\n   */\r\n  toggleDrawer() {\r\n    const drawer = document.querySelector('.vietvan-mobile-drawer');\r\n    if (drawer) {\r\n      const isOpen = drawer.style.right === '0px';\r\n      drawer.style.right = isOpen ? '-100%' : '0px';\r\n      document.body.classList.toggle('vietvan-drawer-open', !isOpen);\r\n      console.log('Drawer toggled:', !isOpen);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show Flarum's default login (SSO compatible)\r\n   */\r\n  showLoginModal() {\r\n    // Close the mobile drawer first\r\n    const drawer = document.querySelector('.vietvan-mobile-drawer');\r\n    if (drawer) {\r\n      drawer.style.right = '-100%';\r\n      document.body.classList.remove('vietvan-drawer-open');\r\n    }\r\n\r\n    // Find and click the default Flarum login button to trigger SSO\r\n    const defaultLoginButton = document.querySelector('.Header-controls .item-logIn button, .HeaderSecondary .item-logIn button, .item-logIn .Button');\r\n    \r\n    if (defaultLoginButton) {\r\n      console.log('Triggering default Flarum login (SSO compatible)');\r\n      defaultLoginButton.click();\r\n    } else {\r\n      // Fallback: Show Flarum's login modal if no SSO button found\r\n      console.log('No SSO button found, showing login modal');\r\n      app.modal.show(LogInModal);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle logout\r\n   */\r\n  logout() {\r\n    const confirmMessage = trans('logout_confirm', 'Bn c chc chn mun ng xut?');\r\n    if (confirm(confirmMessage)) {\r\n      app.session.logout();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate a random string for OAuth state parameter\r\n   */\r\n  generateRandomString(length) {\r\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    let result = '';\r\n    for (let i = 0; i < length; i++) {\r\n      result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return result;\r\n  }\r\n}\r\n","/**\r\n * PageManager - Handles toolbar cleanup and loading state management\r\n * Addresses timing issues with CSS rules, dynamic changes, and stuck loading states\r\n */\r\n\r\nexport default class PageManager {\r\n  constructor() {\r\n    this.observers = new Map();\r\n    this.isProcessing = false;\r\n  }\r\n\r\n  /**\r\n   * Main cleanup function that hides unwanted toolbar elements\r\n   */\r\n  cleanup() {\r\n    if (this.isProcessing) return;\r\n    this.isProcessing = true;\r\n\r\n    try {\r\n      // Hide elements by specific attributes (most reliable)\r\n      this.hideByAttributes();\r\n      \r\n      // Hide elements by nth-child selectors (fallback)\r\n      this.hideByPosition();\r\n      \r\n      // Hide upload buttons\r\n      this.hideUploadButtons();\r\n      \r\n      // Hide rich text toggle\r\n      this.hideRichTextToggle();\r\n      \r\n    } catch (error) {\r\n      console.warn('PageManager: Error during cleanup:', error);\r\n    } finally {\r\n      this.isProcessing = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide elements by data attributes and title attributes\r\n   */\r\n  hideByAttributes() {\r\n    const attributeSelectors = [\r\n      'button[data-hotkey=\"Ctrl+K\"]',\r\n      'button[title*=\"Link\"]',\r\n      'div[data-tooltip*=\"Link\"]',\r\n      'button[data-hotkey=\"Ctrl+>\"]', \r\n      'button[title*=\"Quote\"]',\r\n      'div[data-tooltip*=\"Quote\"]',\r\n      'button[data-hotkey=\"Ctrl+`\"]',\r\n      'button[title*=\"Code\"]',\r\n      'div[data-tooltip*=\"Code\"]'\r\n    ];\r\n\r\n    const toolbar = document.querySelector('.TextEditor-toolbar');\r\n    if (toolbar) {\r\n      attributeSelectors.forEach(selector => {\r\n        const elements = toolbar.querySelectorAll(selector);\r\n        elements.forEach(el => this.hideElement(el));\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide elements by nth-child position (fallback method)\r\n   */\r\n  hideByPosition() {\r\n    const positionSelectors = [\r\n      '.TextEditor-toolbar > div > button:nth-child(4)',\r\n      '.TextEditor-toolbar > div > button:nth-child(5)',\r\n      '.TextEditor-toolbar > div > div:nth-child(1)',\r\n      '.TextEditor-toolbar > div > div:nth-child(6)',\r\n      '.TextEditor-toolbar > div > div:nth-child(7)',\r\n      '.TextEditor-toolbar > div > div:nth-child(10)'\r\n    ];\r\n\r\n    positionSelectors.forEach(selector => {\r\n      const elements = document.querySelectorAll(selector);\r\n      elements.forEach(el => this.hideElement(el));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hide upload buttons\r\n   */\r\n  hideUploadButtons() {\r\n    const uploadSelectors = [\r\n      '.item-fof-upload',\r\n      'li.item-fof-upload',\r\n      '.Button--icon[title*=\"upload\" i]',\r\n      '.Button--icon[title*=\"file\" i]'\r\n    ];\r\n\r\n    uploadSelectors.forEach(selector => {\r\n      const elements = document.querySelectorAll(selector);\r\n      elements.forEach(el => this.hideElement(el));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hide rich text toggle button\r\n   */\r\n  hideRichTextToggle() {\r\n    const elements = document.querySelectorAll('.item-rich-text');\r\n    elements.forEach(el => this.hideElement(el));\r\n  }\r\n\r\n  /**\r\n   * Hide an element completely\r\n   * @param {Element} element \r\n   */\r\n  hideElement(element) {\r\n    if (!element || element.dataset.vietvanHidden) return;\r\n\r\n    // Mark as hidden to prevent repeated processing\r\n    element.dataset.vietvanHidden = 'true';\r\n    \r\n    // Apply multiple hiding methods for maximum effectiveness\r\n    element.style.setProperty('display', 'none', 'important');\r\n    element.style.setProperty('visibility', 'hidden', 'important');\r\n    element.style.setProperty('opacity', '0', 'important');\r\n    element.style.setProperty('pointer-events', 'none', 'important');\r\n    element.style.setProperty('height', '0', 'important');\r\n    element.style.setProperty('width', '0', 'important');\r\n    element.style.setProperty('overflow', 'hidden', 'important');\r\n    element.style.setProperty('margin', '0', 'important');\r\n    element.style.setProperty('padding', '0', 'important');\r\n    \r\n    // Add hidden class\r\n    element.classList.add('vietvan-hidden');\r\n    element.setAttribute('aria-hidden', 'true');\r\n    element.setAttribute('hidden', '');\r\n  }\r\n\r\n  /**\r\n   * Start observing for toolbar and loading changes\r\n   */\r\n  startObserving() {\r\n    // Observe composer area for toolbar creation/updates\r\n    const observeComposer = () => {\r\n      const composer = document.querySelector('#composer');\r\n      if (composer && !this.observers.has('composer')) {\r\n        const observer = new MutationObserver((mutations) => {\r\n          let needsCleanup = false;\r\n          \r\n          mutations.forEach(mutation => {\r\n            if (mutation.type === 'childList') {\r\n              // Check for toolbar-related additions\r\n              mutation.addedNodes.forEach(node => {\r\n                if (node.nodeType === Node.ELEMENT_NODE) {\r\n                  if (node.matches?.('.TextEditor-toolbar') || \r\n                      node.querySelector?.('.TextEditor-toolbar')) {\r\n                    needsCleanup = true;\r\n                  }\r\n                }\r\n              });\r\n            } else if (mutation.type === 'attributes') {\r\n              // Check for style/class changes that might affect toolbar\r\n              if (mutation.target.matches?.('.TextEditor-toolbar *')) {\r\n                needsCleanup = true;\r\n              }\r\n            }\r\n          });\r\n\r\n          if (needsCleanup) {\r\n            setTimeout(() => this.cleanup(), 50);\r\n          }\r\n        });\r\n\r\n        observer.observe(composer, {\r\n          childList: true,\r\n          subtree: true,\r\n          attributes: true,\r\n          attributeFilter: ['style', 'class', 'data-hotkey', 'title']\r\n        });\r\n\r\n        this.observers.set('composer', observer);\r\n      }\r\n    };\r\n\r\n    // Observe body for new composer instances\r\n    const observeBody = () => {\r\n      if (!this.observers.has('body')) {\r\n        const observer = new MutationObserver((mutations) => {\r\n          let needsCleanup = false;\r\n\r\n          mutations.forEach(mutation => {\r\n            if (mutation.type === 'childList') {\r\n              mutation.addedNodes.forEach(node => {\r\n                if (node.nodeType === Node.ELEMENT_NODE) {\r\n                  // Check for composer\r\n                  if (node.matches?.('#composer') || \r\n                      node.querySelector?.('#composer')) {\r\n                    setTimeout(observeComposer, 50);\r\n                    needsCleanup = true;\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          });\r\n\r\n          if (needsCleanup) {\r\n            setTimeout(() => this.cleanup(), 100);\r\n          }\r\n        });\r\n\r\n        observer.observe(document.body, {\r\n          childList: true,\r\n          subtree: true\r\n        });\r\n\r\n        this.observers.set('body', observer);\r\n      }\r\n    };\r\n\r\n    observeComposer();\r\n    observeBody();\r\n  }\r\n\r\n  /**\r\n   * Stop all observers\r\n   */\r\n  stopObserving() {\r\n    this.observers.forEach(observer => observer.disconnect());\r\n    this.observers.clear();\r\n  }\r\n\r\n  /**\r\n   * Initialize the page management system\r\n   */\r\n  initialize() {\r\n    // Initial cleanup\r\n    this.cleanup();\r\n    \r\n    // Start observing for changes\r\n    this.startObserving();\r\n    \r\n    // Periodic cleanup as fallback\r\n    setInterval(() => {\r\n      if (document.querySelector('.TextEditor-toolbar')) {\r\n        this.cleanup();\r\n      }\r\n    }, 30000);\r\n  }\r\n}","import app from 'flarum/forum/app';\r\nimport { extend, override } from 'flarum/common/extend';\r\nimport IndexPage from 'flarum/forum/components/IndexPage';\r\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\r\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\r\nimport HeaderPrimary from 'flarum/forum/components/HeaderPrimary';\r\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\r\nimport TextEditor from 'flarum/common/components/TextEditor';\r\nimport Navigation from 'flarum/forum/components/Navigation';\r\n\r\nimport CustomDiscussionRow from './components/CustomDiscussionRow';\r\nimport DiscussionListHeader from './components/DiscussionListHeader';\r\nimport HeroSection from './components/HeroSection';\r\nimport Logo from './components/Logo';\r\nimport CustomDiscussionTabNavigation from './components/CustomDiscussionTabNavigation';\r\nimport CustomMobileDiscussionToolbar from './components/CustomMobileDiscussionToolbar';\r\nimport CustomMobileDrawer from './components/CustomMobileDrawer';\r\nimport PageManager from './components/ToolbarCleanup';\r\n\r\napp.initializers.add('vietvan-ca-themes', () => {\r\n  // ==========================================\r\n  // Initialize Page Management System\r\n  // ==========================================\r\n  const pageManager = new PageManager();\r\n  pageManager.initialize();\r\n\r\n  // ==========================================\r\n  // Debug: Test CustomMobileDrawer import\r\n  // ==========================================\r\n  console.log('CustomMobileDrawer component:', CustomMobileDrawer);\r\n  console.log('Mithril m function:', m);\r\n\r\n  // ==========================================\r\n  // Alternative Approach: Separate Mobile Drawer\r\n  // ==========================================\r\n  \r\n  /*\r\n  // TEMPORARILY DISABLED FOR DESKTOP TESTING\r\n  \r\n  const createMobileDrawer = () => {\r\n    // Only create on mobile\r\n    if (window.innerWidth > 768) return;\r\n    \r\n    // Check if mobile drawer already exists\r\n    if (document.querySelector('.vietvan-mobile-drawer')) return;\r\n    \r\n    console.log('Creating separate mobile drawer');\r\n    \r\n    // Create a completely separate mobile drawer\r\n    const mobileDrawer = document.createElement('div');\r\n    mobileDrawer.className = 'vietvan-mobile-drawer';\r\n    mobileDrawer.id = 'vietvan-mobile-drawer';\r\n    \r\n    // Style it to overlay the original drawer on mobile\r\n    mobileDrawer.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      right: -100%;\r\n      width: 280px;\r\n      height: 100vh;\r\n      background: white;\r\n      z-index: 1050;\r\n      transition: right 0.3s ease;\r\n      box-shadow: -2px 0 10px rgba(0,0,0,0.1);\r\n    `;\r\n    \r\n    // Mount our custom component\r\n    m.mount(mobileDrawer, CustomMobileDrawer);\r\n    \r\n    // Add to body\r\n    document.body.appendChild(mobileDrawer);\r\n    \r\n    // Override the drawer toggle functionality on mobile\r\n    const originalDrawerToggle = document.querySelector('.App-drawerToggle, [data-drawer-toggle]');\r\n    if (originalDrawerToggle) {\r\n      originalDrawerToggle.addEventListener('click', (e) => {\r\n        if (window.innerWidth <= 768) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          \r\n          // Toggle our custom drawer\r\n          const isOpen = mobileDrawer.style.right === '0px';\r\n          mobileDrawer.style.right = isOpen ? '-100%' : '0px';\r\n          document.body.classList.toggle('vietvan-drawer-open', !isOpen);\r\n        }\r\n      });\r\n    }\r\n    \r\n    console.log('Separate mobile drawer created');\r\n  };\r\n  \r\n  const removeMobileDrawer = () => {\r\n    const mobileDrawer = document.querySelector('.vietvan-mobile-drawer');\r\n    if (mobileDrawer) {\r\n      console.log('Removing separate mobile drawer');\r\n      m.mount(mobileDrawer, null);\r\n      mobileDrawer.remove();\r\n      document.body.classList.remove('vietvan-drawer-open');\r\n    }\r\n  };\r\n  \r\n  const handleResponsiveDrawer = () => {\r\n    if (window.innerWidth <= 768) {\r\n      createMobileDrawer();\r\n    } else {\r\n      removeMobileDrawer();\r\n    }\r\n  };\r\n  \r\n  // Global flag to track if we should use custom drawer\r\n  let useCustomDrawer = false;\r\n  \r\n  const checkMobileState = () => {\r\n    const isMobile = window.innerWidth <= 768;\r\n    useCustomDrawer = isMobile;\r\n    console.log('Mobile state check:', { width: window.innerWidth, isMobile, useCustomDrawer });\r\n    return isMobile;\r\n  };\r\n\r\n  const injectCustomDrawer = () => {\r\n    const isMobile = checkMobileState();\r\n    \r\n    if (!isMobile) {\r\n      // On desktop, only remove custom elements if they exist, don't touch original content\r\n      const customElements = document.querySelectorAll('.CustomMobileDrawer, .CustomMobileDrawer-wrapper');\r\n      if (customElements.length > 0) {\r\n        console.log('Removing custom drawer elements from desktop');\r\n        customElements.forEach(el => {\r\n          const wrapper = el.closest('.CustomMobileDrawer-wrapper');\r\n          if (wrapper) {\r\n            m.mount(wrapper, null);\r\n            wrapper.remove();\r\n          } else {\r\n            el.remove();\r\n          }\r\n        });\r\n        \r\n        // Restore original content if drawer was cleared\r\n        const drawer = document.querySelector('#drawer, .App-drawer, [id*=\"drawer\"]');\r\n        if (drawer) {\r\n          const originalContent = drawer.getAttribute('data-original-content');\r\n          if (originalContent && drawer.innerHTML.trim() === '') {\r\n            console.log('Restoring original drawer content on desktop');\r\n            drawer.innerHTML = originalContent;\r\n            drawer.removeAttribute('data-original-content');\r\n          }\r\n        }\r\n      }\r\n      return; // Exit early on desktop\r\n    }\r\n    \r\n    console.log('Checking drawer injection for mobile, window width:', window.innerWidth);\r\n    \r\n    const drawer = document.querySelector('#drawer, .App-drawer, [id*=\"drawer\"]');\r\n    \r\n    if (drawer && !drawer.querySelector('.CustomMobileDrawer')) {\r\n      console.log('Injecting CustomMobileDrawer into mobile view:', drawer);\r\n      \r\n      // Only store and clear content on mobile\r\n      const originalContent = drawer.innerHTML;\r\n      if (originalContent.trim() !== '') {\r\n        drawer.setAttribute('data-original-content', originalContent);\r\n        console.log('Stored original content:', originalContent.substring(0, 100) + '...');\r\n      }\r\n      \r\n      // Clear existing content only on mobile\r\n      drawer.innerHTML = '';\r\n      \r\n      // Create wrapper\r\n      const wrapper = document.createElement('div');\r\n      wrapper.className = 'CustomMobileDrawer-wrapper';\r\n      \r\n      // Mount component\r\n      m.mount(wrapper, CustomMobileDrawer);\r\n      drawer.appendChild(wrapper);\r\n      \r\n      console.log('CustomMobileDrawer injected successfully on mobile');\r\n    }\r\n  };\r\n\r\n  // Watch for drawer element creation (mobile only)\r\n  const observeDrawer = () => {\r\n    const observer = new MutationObserver((mutations) => {\r\n      // Only observe when custom drawer should be active\r\n      if (useCustomDrawer) {\r\n        mutations.forEach((mutation) => {\r\n          mutation.addedNodes.forEach((node) => {\r\n            if (node.nodeType === 1) { // Element node\r\n              // Check if the added node is a drawer or contains a drawer\r\n              if (node.id === 'drawer' || \r\n                  node.classList?.contains('App-drawer') ||\r\n                  node.querySelector?.('#drawer, .App-drawer')) {\r\n                setTimeout(injectCustomDrawer, 100);\r\n              }\r\n            }\r\n          });\r\n        });\r\n      }\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n\r\n    return observer;\r\n  };\r\n\r\n  // Initialize responsive drawer\r\n  document.addEventListener('DOMContentLoaded', handleResponsiveDrawer);\r\n  setTimeout(handleResponsiveDrawer, 500);\r\n  setTimeout(handleResponsiveDrawer, 1000);\r\n\r\n  // Handle window resize\r\n  let resizeTimeout;\r\n  window.addEventListener('resize', () => {\r\n    clearTimeout(resizeTimeout);\r\n    resizeTimeout = setTimeout(() => {\r\n      console.log('Window resized, handling responsive drawer');\r\n      handleResponsiveDrawer();\r\n    }, 250);\r\n  });\r\n\r\n  // Run on route changes\r\n  if (app.history) {\r\n    app.history.initialized?.then(() => {\r\n      app.history.router.on('changed', () => {\r\n        setTimeout(handleResponsiveDrawer, 100);\r\n      });\r\n    });\r\n  }\r\n\r\n  // END OF TEMPORARILY DISABLED MOBILE DRAWER CODE\r\n  */\r\n\r\n  // ==========================================\r\n  // Simple Mobile-Only Custom Drawer (Non-Interfering)\r\n  // ==========================================\r\n  \r\n  const createMobileDrawer = () => {\r\n    // Only create on mobile devices\r\n    if (window.innerWidth > 768) return;\r\n    \r\n    // Check if mobile drawer already exists\r\n    if (document.querySelector('.vietvan-mobile-drawer')) return;\r\n    \r\n    console.log('Creating simple mobile drawer');\r\n    \r\n    // Create a completely separate mobile drawer\r\n    const mobileDrawer = document.createElement('div');\r\n    mobileDrawer.className = 'vietvan-mobile-drawer';\r\n    mobileDrawer.id = 'vietvan-mobile-drawer';\r\n    \r\n    // Style it to overlay on mobile (hidden by default)\r\n    mobileDrawer.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      right: -100%;\r\n      width: 280px;\r\n      height: 100vh;\r\n      background: white;\r\n      z-index: 1050;\r\n      transition: right 0.3s ease;\r\n      box-shadow: -2px 0 10px rgba(0,0,0,0.1);\r\n      overflow-y: auto;\r\n    `;\r\n    \r\n    // Mount our custom component\r\n    try {\r\n      m.mount(mobileDrawer, CustomMobileDrawer);\r\n      console.log('CustomMobileDrawer mounted successfully');\r\n    } catch (error) {\r\n      console.error('Error mounting CustomMobileDrawer:', error);\r\n      return;\r\n    }\r\n    \r\n    // Add to body\r\n    document.body.appendChild(mobileDrawer);\r\n    console.log('Mobile drawer added to body');\r\n    \r\n    // Add simple hamburger menu integration (non-interfering)\r\n    const setupHamburgerIntegration = () => {\r\n      const hamburger = document.querySelector('.App-drawerToggle, .Button--icon[aria-label*=\"menu\"], .Header-controls .Button--icon');\r\n      if (hamburger && window.innerWidth <= 768) {\r\n        console.log('Found hamburger button, adding mobile integration');\r\n        \r\n        // Add a simple click listener that doesn't interfere with default behavior\r\n        hamburger.addEventListener('click', (e) => {\r\n          if (window.innerWidth <= 768) {\r\n            // Small delay to let default drawer start opening, then show ours instead\r\n            setTimeout(() => {\r\n              const defaultDrawer = document.querySelector('#drawer, .App-drawer');\r\n              if (defaultDrawer && defaultDrawer.classList.contains('in')) {\r\n                // Default drawer is opening, hide it and show ours\r\n                defaultDrawer.classList.remove('in');\r\n                defaultDrawer.style.transform = 'translateX(-100%)';\r\n                \r\n                // Show our custom drawer\r\n                mobileDrawer.style.right = '0px';\r\n                document.body.classList.add('vietvan-drawer-open');\r\n                console.log('Switched from default to custom drawer');\r\n              }\r\n            }, 50);\r\n          }\r\n        });\r\n      }\r\n    };\r\n    \r\n    // Setup hamburger integration with delays\r\n    setTimeout(setupHamburgerIntegration, 500);\r\n    setTimeout(setupHamburgerIntegration, 1000);\r\n    \r\n    console.log('Simple mobile drawer created successfully');\r\n  };\r\n  \r\n  const removeMobileDrawer = () => {\r\n    const mobileDrawer = document.querySelector('.vietvan-mobile-drawer');\r\n    if (mobileDrawer) {\r\n      console.log('Removing mobile drawer for desktop');\r\n      m.mount(mobileDrawer, null);\r\n      mobileDrawer.remove();\r\n      document.body.classList.remove('vietvan-drawer-open');\r\n    }\r\n  };\r\n  \r\n  const handleResponsiveDrawer = () => {\r\n    if (window.innerWidth <= 768) {\r\n      createMobileDrawer();\r\n    } else {\r\n      removeMobileDrawer();\r\n    }\r\n  };\r\n\r\n  // Initialize mobile drawer (simple approach)\r\n  setTimeout(() => {\r\n    if (window.innerWidth <= 768) {\r\n      createMobileDrawer();\r\n    }\r\n  }, 1000);\r\n\r\n  // Handle window resize\r\n  let mobileResizeTimeout;\r\n  window.addEventListener('resize', () => {\r\n    clearTimeout(mobileResizeTimeout);\r\n    mobileResizeTimeout = setTimeout(handleResponsiveDrawer, 250);\r\n  });\r\n\r\n  // ==========================================\r\n  // Change Hide Button Icon to Eye\r\n  // ==========================================\r\n  \r\n  // Use DOM manipulation to change the hide button icon after render\r\n  const changeHideButtonIcons = () => {\r\n    const hideButtons = document.querySelectorAll('.item-hide button .fa-trash-alt');\r\n    hideButtons.forEach(icon => {\r\n      if (icon.classList.contains('fa-trash-alt')) {\r\n        icon.classList.remove('fa-trash-alt');\r\n        icon.classList.add('fa-eye');\r\n      }\r\n    });\r\n    \r\n    // Change hidden badge icons\r\n    const hiddenBadges = document.querySelectorAll('.item-hidden .fas.fa-trash, .Badge--hidden .fas.fa-trash');\r\n    hiddenBadges.forEach(icon => {\r\n      if (icon.classList.contains('fa-trash')) {\r\n        icon.classList.remove('fa-trash');\r\n        icon.classList.add('fa-eye');\r\n      }\r\n    });\r\n  };\r\n\r\n  // Run icon replacement on page load and route changes\r\n  const initializeHideButtonChanges = () => {\r\n    // Initial run\r\n    setTimeout(changeHideButtonIcons, 500);\r\n    \r\n    // Run on route changes\r\n    if (app.history?.initialized) {\r\n      app.history.initialized.then(() => {\r\n        app.history.router.on('changed', () => {\r\n          setTimeout(changeHideButtonIcons, 500);\r\n        });\r\n      });\r\n    }\r\n    \r\n    // Also run periodically to catch dynamically loaded content\r\n    setInterval(changeHideButtonIcons, 2000);\r\n  };\r\n\r\n  initializeHideButtonChanges();\r\n\r\n  // ==========================================\r\n  // Set Light Theme as Default\r\n  // ==========================================\r\n  const setDefaultLightTheme = () => {\r\n    // Only set default if user hasn't explicitly chosen a theme preference\r\n    if (app.session.user) {\r\n      const nightModePreference = app.session.user.preferences().fofNightMode;\r\n      \r\n      // If night mode preference is null/undefined, set default to light\r\n      if (nightModePreference === null || nightModePreference === undefined) {\r\n        app.session.user.savePreferences({\r\n          fofNightMode: false\r\n        }).catch(() => {\r\n          // Ignore errors if preferences can't be saved\r\n        });\r\n      }\r\n    }\r\n    \r\n    // For guests, remove any dark theme classes that might be applied by system preferences\r\n    const body = document.body;\r\n    const html = document.documentElement;\r\n    \r\n    // Check if no explicit theme choice has been made\r\n    const hasExplicitDarkTheme = localStorage.getItem('fof-nightmode') === 'true' || \r\n                                 localStorage.getItem('darkMode') === 'true';\r\n    \r\n    if (!hasExplicitDarkTheme) {\r\n      // Remove potential system-applied dark classes\r\n      [body, html].forEach(element => {\r\n        if (element) {\r\n          const darkClasses = ['dark', 'dark-mode', 'fof-nightmode'];\r\n          darkClasses.forEach(className => {\r\n            element.classList.remove(className);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  // Initialize default light theme\r\n  const initializeDefaultTheme = () => {\r\n    // Set default theme once when app loads\r\n    setTimeout(setDefaultLightTheme, 100);\r\n  };\r\n\r\n  initializeDefaultTheme();\r\n\r\n  // ==========================================\r\n  // Auto Text Color for Discussion Tags and Buttons\r\n  // ==========================================\r\n  const adjustTextColors = () => {\r\n    // Handle discussion tags\r\n    const coloredTags = document.querySelectorAll('.discussion-tag.colored');\r\n    coloredTags.forEach(tag => adjustElementTextColor(tag, 'backgroundColor'));\r\n    \r\n    // Handle colored buttons (like create discussion button)\r\n    const coloredButtons = document.querySelectorAll('.Button--tagColored, .Button--primary[style*=\"--color\"]');\r\n    coloredButtons.forEach(button => {\r\n      // Check if button has custom --color property\r\n      const customColor = button.style.getPropertyValue('--color');\r\n      if (customColor) {\r\n        adjustElementTextColor(button, 'customColor', customColor);\r\n      }\r\n    });\r\n  };\r\n\r\n  const adjustElementTextColor = (element, colorSource, customColor = null) => {\r\n    let backgroundColor;\r\n    \r\n    if (colorSource === 'customColor' && customColor) {\r\n      backgroundColor = customColor;\r\n    } else {\r\n      backgroundColor = window.getComputedStyle(element).backgroundColor;\r\n    }\r\n    \r\n    // Parse color values - handle both rgb() and hex formats\r\n    let r, g, b;\r\n    \r\n    if (backgroundColor.startsWith('#')) {\r\n      // Handle hex colors - fix the parsing\r\n      const hex = backgroundColor.replace('#', '');\r\n      if (hex.length === 3) {\r\n        // Handle short hex like #FFF\r\n        r = parseInt(hex.substr(0, 1) + hex.substr(0, 1), 16);\r\n        g = parseInt(hex.substr(1, 1) + hex.substr(1, 1), 16);\r\n        b = parseInt(hex.substr(2, 1) + hex.substr(2, 1), 16);\r\n      } else if (hex.length === 6) {\r\n        // Handle full hex like #FFF300\r\n        r = parseInt(hex.substr(0, 2), 16);\r\n        g = parseInt(hex.substr(2, 2), 16);\r\n        b = parseInt(hex.substr(4, 2), 16);\r\n      } else {\r\n        return; // Skip if invalid hex format\r\n      }\r\n    } else {\r\n      // Handle rgb() colors\r\n      const rgbMatch = backgroundColor.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\r\n      if (rgbMatch) {\r\n        [, r, g, b] = rgbMatch.map(Number);\r\n      } else {\r\n        return; // Skip if can't parse color\r\n      }\r\n    }\r\n    \r\n    // Calculate different brightness metrics\r\n    const wcagLuminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\r\n    const perceivedBrightness = Math.sqrt(0.241 * r * r + 0.691 * g * g + 0.068 * b * b) / 255;\r\n    const averageBrightness = (r + g + b) / (3 * 255);\r\n    \r\n    // Calculate saturation to detect bright colors\r\n    const max = Math.max(r, g, b) / 255;\r\n    const min = Math.min(r, g, b) / 255;\r\n    const saturation = max === 0 ? 0 : (max - min) / max;\r\n    \r\n    // Calculate contrast ratios with black and white text\r\n    const contrastWithBlack = (Math.max(wcagLuminance, 0.05) + 0.05) / (0.05 + 0.05);\r\n    const contrastWithWhite = (1.05) / (Math.max(wcagLuminance, 0.05) + 0.05);\r\n    \r\n    // For very bright colors like yellow (#FFF300), use lower threshold\r\n    // Yellow and bright colors should use black text\r\n    const brightnessThreshold = saturation > 0.8 && wcagLuminance > 0.7 ? 0.6 : \r\n                               saturation > 0.4 ? 0.75 : 0.65;\r\n    \r\n    const shouldUseBlackText = wcagLuminance > brightnessThreshold && \r\n                               perceivedBrightness > (brightnessThreshold - 0.1) && \r\n                               averageBrightness > (brightnessThreshold - 0.15) &&\r\n                               contrastWithBlack > contrastWithWhite;\r\n    \r\n    // Apply styles with !important for stronger override\r\n    element.style.setProperty('color', shouldUseBlackText ? '#000000' : '#ffffff', 'important');\r\n    \r\n    // Add appropriate text shadow with better contrast for colorful backgrounds\r\n    const textShadow = shouldUseBlackText \r\n      ? '0 0 1px rgba(255, 255, 255, 0.6)' \r\n      : '0 0 1px rgba(0, 0, 0, 0.8)';\r\n    element.style.setProperty('text-shadow', textShadow, 'important');\r\n    \r\n    // For buttons, also ensure the background color is applied correctly\r\n    if (colorSource === 'customColor' && customColor) {\r\n      element.style.setProperty('background-color', customColor, 'important');\r\n      // Remove any conflicting classes\r\n      element.classList.remove('text-contrast--dark', 'text-contrast--light');\r\n    }\r\n  };\r\n\r\n  // Initialize text color adjustment\r\n  const initializeTextColors = () => {\r\n    // Initial run\r\n    setTimeout(adjustTextColors, 200);\r\n    \r\n    // Run on route changes\r\n    if (app.history?.initialized) {\r\n      app.history.initialized.then(() => {\r\n        app.history.router.on('changed', () => {\r\n          setTimeout(adjustTextColors, 200);\r\n        });\r\n      });\r\n    }\r\n    \r\n    // Run periodically to catch dynamically loaded content\r\n    setInterval(adjustTextColors, 3000);\r\n    \r\n    // Watch for DOM changes (new discussions loaded)\r\n    const observer = new MutationObserver(() => {\r\n      setTimeout(adjustTextColors, 100);\r\n    });\r\n    \r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true\r\n    });\r\n  };\r\n\r\n  initializeTextColors();\r\n\r\n  // ==========================================\r\n  // TextEditor Extensions (Simplified)\r\n  // ==========================================\r\n  \r\n  // Ensure toolbar cleanup runs after TextEditor is created/updated\r\n  extend(TextEditor.prototype, 'oncreate', function() {\r\n    setTimeout(() => {\r\n      pageManager.cleanup();\r\n      // Removed aggressive loading management here\r\n    }, 50);\r\n  });\r\n\r\n  extend(TextEditor.prototype, 'onupdate', function() {\r\n    setTimeout(() => pageManager.cleanup(), 25);\r\n  });\r\n\r\n  // Use oncreate to inject custom mobile drawer after IndexPage is created\r\n  /*\r\n  // TEMPORARILY DISABLED - CAUSING DESKTOP HEADER ISSUES\r\n  extend(IndexPage.prototype, 'oncreate', function() {\r\n    this.injectCustomDrawer();\r\n    // Removed aggressive loading management\r\n  });\r\n\r\n  extend(IndexPage.prototype, 'onupdate', function() {\r\n    this.injectCustomDrawer();\r\n    // Removed aggressive loading management\r\n  });\r\n\r\n  // Add method to inject custom drawer\r\n  IndexPage.prototype.injectCustomDrawer = function() {\r\n    // Try multiple possible drawer selectors\r\n    const drawer = document.getElementById('drawer') || \r\n                   document.querySelector('.App-drawer') || \r\n                   document.querySelector('#app-navigation .Drawer');\r\n    \r\n    if (drawer && !drawer.querySelector('.CustomMobileDrawer')) {\r\n      console.log('Found drawer element:', drawer);\r\n      \r\n      // Try multiple possible content selectors\r\n      let drawerContent = drawer.querySelector('.Drawer-content') || \r\n                         drawer.querySelector('.App-drawer') || \r\n                         drawer.querySelector('.Drawer') ||\r\n                         drawer;\r\n      \r\n      if (drawerContent) {\r\n        console.log('Found drawer content:', drawerContent);\r\n        \r\n        // Create container if it doesn't exist\r\n        let customDrawerContainer = drawerContent.querySelector('.CustomMobileDrawer-container');\r\n        if (!customDrawerContainer) {\r\n          customDrawerContainer = document.createElement('div');\r\n          customDrawerContainer.className = 'CustomMobileDrawer-container';\r\n          \r\n          try {\r\n            // Mount the custom drawer component\r\n            m.mount(customDrawerContainer, CustomMobileDrawer);\r\n            console.log('CustomMobileDrawer mounted successfully');\r\n            \r\n            // Clear existing content and add our custom drawer\r\n            drawerContent.innerHTML = '';\r\n            drawerContent.appendChild(customDrawerContainer);\r\n            \r\n          } catch (error) {\r\n            console.error('Error mounting CustomMobileDrawer:', error);\r\n          }\r\n        }\r\n      } else {\r\n        console.log('Drawer content not found');\r\n      }\r\n    } else if (!drawer) {\r\n      console.log('Drawer element not found');\r\n    }\r\n  };\r\n  */\r\n\r\n  // Utility function to find element by class path\r\n  const findElementByPath = (vnode, path) => {\r\n    let current = vnode;\r\n\r\n    for (const className of path) {\r\n      if (!current?.children || !Array.isArray(current.children)) {\r\n        return null;\r\n      }\r\n\r\n      const found = current.children.find((child) => child?.attrs?.className?.includes(className));\r\n\r\n      if (!found) return null;\r\n      current = found;\r\n    }\r\n\r\n    return current;\r\n  };\r\n\r\n  // Check for register button visibility using document events\r\n  const checkRegisterButtonVisibility = () => {\r\n    try {\r\n      if (app.forum?.attribute) {\r\n        const showRegisterButton = app.forum.attribute('vietvan_ca_show_register_button') === '1';\r\n\r\n        if (!showRegisterButton) {\r\n          const registerButton = document.querySelector('.item-signUp');\r\n          registerButton?.remove();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking register button visibility:', error);\r\n    }\r\n  };\r\n\r\n  // Check for custom logo, if it exists, remove the default logo\r\n  const checkCustomLogo = () => {\r\n    try {\r\n      const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\r\n      const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\r\n\r\n      if (lightLogoPath || darkLogoPath) {\r\n        const defaultLogo = document.querySelector('.Header-title');\r\n        defaultLogo?.remove();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking custom logo:', error);\r\n    }\r\n  };\r\n\r\n  // Run all component checks\r\n  const runComponentChecks = () => {\r\n    checkRegisterButtonVisibility();\r\n    checkCustomLogo();\r\n  };\r\n\r\n  // Initialize component checks\r\n  const initializeChecks = () => {\r\n    if (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n      setTimeout(runComponentChecks, 100);\r\n    } else {\r\n      document.addEventListener('DOMContentLoaded', () => {\r\n        setTimeout(runComponentChecks, 100);\r\n      });\r\n    }\r\n\r\n    // Run when route changes\r\n    app.history.initialized?.then(() => {\r\n      app.history.router.on('changed', runComponentChecks);\r\n    });\r\n  };\r\n\r\n  // Initialize checks\r\n  initializeChecks();\r\n\r\n  // Extend the HeaderPrimary component to replace the logo with a custom one\r\n  extend(HeaderPrimary.prototype, 'items', function (items) {\r\n    const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\r\n    const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\r\n\r\n    if (lightLogoPath || darkLogoPath) {\r\n      items.add('logo', <Logo />, 90);\r\n    }\r\n  });\r\n\r\n  // Extend the HeaderSecondary component to remove the search component\r\n  extend(HeaderSecondary.prototype, 'items', function (items) {\r\n    if (items.has('search')) {\r\n      items.remove('search');\r\n    }\r\n  });\r\n\r\n  // Extend the DiscussionListItem component to use the custom row\r\n  extend(DiscussionListItem.prototype, 'view', function (vnode) {\r\n    vnode.children = [\r\n      m(CustomDiscussionRow, {\r\n        discussion: this.attrs.discussion,\r\n      }),\r\n    ];\r\n  });\r\n\r\n  // Extend the DiscussionList component to add a header\r\n  extend(DiscussionList.prototype, 'view', function (vnode) {\r\n    const originalChildren = vnode.children;\r\n    vnode.children = [m('ul.DiscussionList', [m(DiscussionListHeader), ...originalChildren])];\r\n  });\r\n\r\n  // Extend the IndexPage component to add a hero section and custom tabs\r\n  extend(IndexPage.prototype, 'view', function (vnode) {\r\n    // Add HeroSection at the beginning\r\n    const heroSectionInstance = m(HeroSection);\r\n    const originalChildren = vnode.children;\r\n    vnode.children = [heroSectionInstance, ...originalChildren];\r\n\r\n    // Create custom mobile discussion toolbar instance\r\n    const customMobileDiscussionToolbarInstance = <CustomMobileDiscussionToolbar />;\r\n\r\n    // Create custom tabs instance\r\n    const customTabsInstance = <CustomDiscussionTabNavigation />;\r\n\r\n    // Find toolbar using optimized path traversal\r\n    const toolbarPath = ['container', 'sideNavContainer', 'IndexPage-results', 'IndexPage-toolbar', 'IndexPage-toolbar-view'];\r\n    const toolbarDiv = findElementByPath({ children: originalChildren }, toolbarPath);\r\n\r\n    if (toolbarDiv) {\r\n      // Replace toolbar content with custom tabs\r\n      toolbarDiv.children = [customMobileDiscussionToolbarInstance, customTabsInstance];\r\n    } else {\r\n      console.warn('IndexPage-toolbar-view not found. CustomTabNavigation not added.');\r\n    }\r\n\r\n    // Run component checks after render\r\n    setTimeout(runComponentChecks, 100);\r\n  });\r\n\r\n  // Add mobile logo using DOM manipulation\r\n  extend(IndexPage.prototype, 'oncreate', function () {\r\n    const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\r\n    const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\r\n\r\n    if (lightLogoPath || darkLogoPath) {\r\n      this.addMobileLogo();\r\n    }\r\n  });\r\n\r\n  extend(IndexPage.prototype, 'onupdate', function () {\r\n    const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\r\n    const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\r\n\r\n    if (lightLogoPath || darkLogoPath) {\r\n      this.addMobileLogo();\r\n    }\r\n  });\r\n\r\n  // Add method to IndexPage prototype\r\n  IndexPage.prototype.addMobileLogo = function () {\r\n    const navElement = document.getElementById('app-navigation');\r\n\r\n    if (navElement && !navElement.querySelector('.Navigation-logo')) {\r\n      // Create logo container\r\n      const logoDiv = document.createElement('div');\r\n      logoDiv.className = 'Navigation-logo Mobile-only';\r\n\r\n      // Mount Logo component into the div\r\n      m.mount(logoDiv, {\r\n        view: () => m(Logo, { imageStyle: { height: '30px' } }),\r\n      });\r\n\r\n      // Insert at the beginning of navigation (before App-backControl)\r\n      const backControl = navElement.querySelector('.App-backControl');\r\n      if (backControl) {\r\n        navElement.insertBefore(logoDiv, backControl);\r\n      } else {\r\n        navElement.insertBefore(logoDiv, navElement.firstChild);\r\n      }\r\n    }\r\n  };\r\n\r\n  extend(IndexPage.prototype, 'onremove', function () {\r\n    const navElement = document.getElementById('app-navigation');\r\n    const logoElement = navElement?.querySelector('.Navigation-logo');\r\n    \r\n    if (logoElement) {\r\n      m.mount(logoElement, null); // Unmount the component\r\n      logoElement.remove();\r\n    }\r\n  });\r\n\r\n  // Adding scale font size feature\r\n  let currentScale = 1.05;\r\n\r\n  // Apply initial font zoom\r\n  applyFontZoom(currentScale);\r\n});\r\n\r\nfunction applyFontZoom(scale) {\r\n  // Remove existing font zoom styles\r\n  const existingStyle = document.getElementById('font-zoom-style');\r\n  if (existingStyle) {\r\n    existingStyle.remove();\r\n  }\r\n\r\n  // Create new style element\r\n  const style = document.createElement('style');\r\n  style.id = 'font-zoom-style';\r\n\r\n  // Apply zoom to various elements\r\n  style.textContent = `\r\n    .App {\r\n      font-size: ${scale}rem !important;\r\n    }\r\n    \r\n    /* Ensure consistent scaling across all text elements */\r\n    .Post-body,\r\n    .PostPreview-body,\r\n    .UserCard-info,\r\n    .NotificationGrid-content,\r\n    .Dropdown-menu,\r\n    .Modal-body,\r\n    .Form-group label,\r\n    .Form-group input,\r\n    .Form-group textarea,\r\n    .TagLabel,\r\n    .Badge {\r\n      font-size: ${scale}em !important;\r\n    }\r\n    \r\n    /* Scale headings proportionally */\r\n    h1 { font-size: ${scale * 2}rem !important; }\r\n    h2 { font-size: ${scale * 1.5}rem !important; }\r\n    h3 { font-size: ${scale * 1.25}rem !important; }\r\n    h4 { font-size: ${scale * 1.125}rem !important; }\r\n    h5 { font-size: ${scale * 1}rem !important; }\r\n    h6 { font-size: ${scale * 0.875}rem !important; }\r\n    \r\n    /* Scale code blocks */\r\n    code,\r\n    pre {\r\n      font-size: ${scale * 0.875}em !important;\r\n    }\r\n  `;\r\n\r\n  document.head.appendChild(style);\r\n\r\n  // Store for guests as mitigate if improved\r\n  localStorage.setItem('flarum-font-zoom-scale', scale.toString());\r\n}\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","_inheritsLoose","create","constructor","TopicColumn","_Component","apply","arguments","view","discussion","this","attrs","firstPost","tags","isSticky","isLocked","m","icon","Link","href","app","title","map","tag","className","color","style","backgroundColor","name","attribute","contentPlain","Component","ReplyColumn","_discussion$replyCoun","replyCount","ViewColumn","viewCount","getColorClass","index","colorClasses","length","ActivityColumn","lastPostedAt","timeSince","date","dateObj","Date","isNaN","getTime","diffTime","diffDays","Math","floor","diffHours","diffMinutes","getTimeSince","LastUsersColumn","latestPosters","slice","user","i","username","userName","avatarUrl","avatar_url","src","alt","charAt","toUpperCase","renderUserAvatar","CustomDiscussionRow","DiscussionListHeader","trans","CustomMobileDiscussionToolbar","_proto","_this","currentDate","SelectDropdown","buttonClassName","getNavigationItems","toArray","class","type","onclick","newDiscussionAction","items","ItemList","add","LinkButton","allTags","all","filter","hasParent","parent","position","sort","b","forEach","id","slug","Promise","resolve","reject","load","DiscussionComposer","show","LogInModal","HeroSection","oninit","vnode","_forum$attribute","_forum$attribute2","forum","enabled","mode","extensions","setupNightModeListener","setupSystemModeListener","setupBodyClassObserver","setTimeout","computeMode","redraw","newMode","locale","translator","getLocale","titleKey","descKey","description","showText","hasCustomColor","titleStyle","descriptionStyle","titleColor","subtitleColor","_document$cookie$spli","document","body","classList","contains","session","pref","preferences","fofNightMode","window","matchMedia","matches","cookieValue","cookie","split","find","row","startsWith","_this2","nightModeHandler","event","detail","addEventListener","_this3","mediaQuery","systemModeHandler","_this4","bodyObserver","MutationObserver","observe","attributes","attributeFilter","onremove","removeEventListener","disconnect","getBackgroundStyle","bgAttr","bgUrl","height","backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","undefined","currentPath","location","pathname","backgroundStyle","Search","state","search","Logo","_app$session$user","logoAttr","logoUrl","customUrl","imageStyle","CustomDiscussionTabNavigation","_app$search$params","currentSort","params","tabs","label","sortParam","default","tab","isActive","routeName","isFilter","q","includes","filterParam","navigateTo","newPath","route","set","fallback","result","CustomMobileDrawer","toggleDrawer","listItems","menuItems","loggedInSection","guestSection","mainSiteUrl","replace","guidelinesTag","findTagBySlug","languageDropdown","themeToggle","locales","currentLocale","keys","getLocaleName","toggleDropdown","changeLocale","_app$data$locales","savePreferences","then","reload","toggleTheme","nightModeToggle","querySelector","click","toggle","isDark","localStorage","setItem","dropdownId","preventDefault","stopPropagation","dropdown","getElementById","baseMainUrl","showLoginModal","socialLogin","provider","backendUrl","console","error","alert","drawer","right","remove","generateRandomString","oauthUrl","encodeURIComponent","origin","log","popup","open","screen","width","focus","_this5","displayName","logout","isOpen","defaultLoginButton","confirmMessage","confirm","chars","random","PageManager","observers","Map","isProcessing","cleanup","hideByAttributes","hideByPosition","hideUploadButtons","hideRichTextToggle","warn","toolbar","selector","querySelectorAll","el","hideElement","element","dataset","vietvanHidden","setProperty","setAttribute","startObserving","observeComposer","composer","has","observer","mutations","needsCleanup","mutation","addedNodes","node","nodeType","Node","ELEMENT_NODE","target","childList","subtree","observeBody","stopObserving","clear","initialize","_this6","setInterval","pageManager","mobileResizeTimeout","createMobileDrawer","innerWidth","mobileDrawer","createElement","cssText","mount","appendChild","setupHamburgerIntegration","hamburger","defaultDrawer","transform","handleResponsiveDrawer","clearTimeout","_app$history","changeHideButtonIcons","initialized","router","on","nightModePreference","html","documentElement","getItem","_app$history2","adjustTextColors","adjustElementTextColor","button","customColor","getPropertyValue","colorSource","r","g","getComputedStyle","hex","parseInt","substr","rgbMatch","match","_rgbMatch$map","Number","wcagLuminance","perceivedBrightness","sqrt","averageBrightness","max","min","saturation","contrastWithBlack","contrastWithWhite","brightnessThreshold","shouldUseBlackText","textShadow","extend","TextEditor","_app$history$initiali","runComponentChecks","_app$forum","registerButton","checkRegisterButtonVisibility","lightLogoPath","darkLogoPath","defaultLogo","checkCustomLogo","readyState","HeaderPrimary","HeaderSecondary","DiscussionListItem","children","DiscussionList","originalChildren","concat","IndexPage","heroSectionInstance","customMobileDiscussionToolbarInstance","customTabsInstance","toolbarDiv","_ret","_step","current","_loop","_current","value","Array","isArray","v","found","child","_child$attrs","_iterator","_createForOfIteratorHelperLoose","done","findElementByPath","addMobileLogo","navElement","logoDiv","backControl","insertBefore","firstChild","logoElement","scale","existingStyle","textContent","head","toString","applyFontZoom"],"sourceRoot":""}
=======
{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@vietvan-ca/flarum-themes/webpack/bootstrap","webpack://@vietvan-ca/flarum-themes/webpack/runtime/compat get default export","webpack://@vietvan-ca/flarum-themes/webpack/runtime/define property getters","webpack://@vietvan-ca/flarum-themes/webpack/runtime/hasOwnProperty shorthand","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/app']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/extend']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/HeaderPrimary']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/HeaderSecondary']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@vietvan-ca/flarum-themes/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@vietvan-ca/flarum-themes/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/Navigation']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/Component']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/Link']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@vietvan-ca/flarum-themes/./src/forum/components/TopicColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ReplyColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ViewColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/utils/discussionHelpers.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ActivityColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/LastUsersColumn.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomDiscussionRow.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/DiscussionListHeader.js","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/Search']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['forum/components/LogInModal']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/Button']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/components/SelectDropdown']\"","webpack://@vietvan-ca/flarum-themes/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomMobileDiscussionToolbar.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/HeroSection.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/Logo.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomDiscussionTabNavigation.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomMobileDrawer.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomMobileCreateModal.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/CustomMobileComposer.js","webpack://@vietvan-ca/flarum-themes/./src/forum/components/ToolbarCleanup.js","webpack://@vietvan-ca/flarum-themes/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderPrimary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/HeaderSecondary'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Navigation'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Link from 'flarum/common/components/Link';\nimport icon from 'flarum/common/helpers/icon';\n\n/**\n * Renders the topic column with title, tags, and excerpt\n */\nexport default class TopicColumn extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n    const firstPost = discussion.firstPost();\n    const tags = discussion.tags() || [];\n    \n    // Get sticky and locked status\n    const isSticky = discussion.isSticky();\n    const isLocked = discussion.isLocked();\n    \n    return m('div.discussion-topic', [\n      m('div.discussion-badges', [\n        // Display sticky and locked badges if applicable\n        isSticky ? m('span.Badge.Badge--sticky', [\n          icon('fas fa-thumbtack')\n        ]) : null,\n        isLocked ? m('span.Badge.Badge--locked', [\n          icon('fas fa-lock'),\n        ]) : null,\n      ]),\n      m('div.discussion-title', [\n        m(Link, { \n          href: app.route.discussion(discussion) \n        }, discussion.title())\n      ]),\n      m('div.discussion-tags', [\n        tags.map(tag => m('span.discussion-tag', { \n          className: tag.color() ? 'colored' : '',\n          style: tag.color() ? { backgroundColor: tag.color() } : {}\n        }, tag.name())),\n      ]),\n      app.forum.attribute('custom-discussion-list.enable_excerpts') !== false ? \n        m('div.discussion-excerpt', firstPost?.contentPlain() || '') : null\n    ]);\n  }\n}","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\n\n/**\n * Renders the reply count column\n */\nexport default class ReplyColumn extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n    const replyCount = discussion.replyCount() ?? 0;\n\n    return m('div.discussion-reply', [\n      m('span', replyCount),\n    ]);\n  }\n}\n","import Component from 'flarum/common/Component';\n\n/**\n * Renders the view count column\n */\nexport default class ViewColumn extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n    const viewCount = discussion.attribute('views') || 0;\n    \n    return m('div.discussion-view', [\n      m('span', viewCount)\n    ]);\n  }\n}","/**\n * Helper function to calculate time since in days\n */\nexport function getTimeSince(date) {\n  if (!date) return '-';\n\n  // Convert to Date object if string\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\n\n  // Check if date is valid\n  if (isNaN(dateObj.getTime())) return '-';\n\n  const now = new Date();\n  const diffTime = now - dateObj;\n\n  // If time is in the future, return placeholder\n  if (diffTime < 0) return '-';\n\n  // Calculate time differences\n  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n  const diffHours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n  const diffMinutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));\n\n  // Return only the largest time unit\n  if (diffDays >= 30) {\n    // More than a month, show months\n    const diffMonths = Math.floor(diffDays / 30);\n    return diffMonths + 'mo';\n  }\n\n  if (diffDays > 0) {\n    return diffDays + 'd';\n  }\n\n  if (diffHours > 0) {\n    return diffHours + 'h';\n  }\n\n  if (diffMinutes > 0) {\n    return diffMinutes + 'm';\n  }\n\n  // If less than a minute\n  return 'now';\n}\n\n/**\n * Helper function to get user initials\n */\nexport function getInitials(username) {\n  if (!username) return '';\n  return username.charAt(0).toUpperCase();\n}\n\n/**\n * Helper function to get color class based on index\n */\nexport function getColorClass(index) {\n  const colorClasses = ['color-1', 'color-2', 'color-3', 'color-4', 'color-5'];\n  return colorClasses[index % colorClasses.length];\n}\n\n/**\n * Renders user avatar with either image or initials\n */\nexport function renderUserAvatar(user, index) {\n  if (!user) return null;\n\n  const userName = user.username || '';\n  const avatarUrl = user.avatar_url;\n\n  if (avatarUrl) {\n    // If avatar URL exists, render the image\n    return m(\n      'span.user-avatar',\n      { title: userName },\n      m('img.avatar-image', {\n        src: avatarUrl,\n        alt: userName,\n      })\n    );\n  } else {\n    // If no avatar URL, show initials with color background\n    return m(\n      'span.user-avatar',\n      { title: userName },\n      m(\n        'span.user-initial',\n        {\n          className: getColorClass(index),\n        },\n        getInitials(userName)\n      )\n    );\n  }\n}\n","import Component from 'flarum/common/Component';\nimport { getTimeSince } from '../utils/discussionHelpers';\n\n/**\n * Renders the activity column with time since last post and active users\n */\nexport default class ActivityColumn extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n    const lastPostedAt = discussion.lastPostedAt();\n    const timeSince = lastPostedAt ? getTimeSince(new Date(lastPostedAt)) : '';\n\n    return m('div.discussion-activity', [m('span', timeSince)]);\n  }\n}\n","import Component from 'flarum/common/Component';\nimport { renderUserAvatar } from '../utils/discussionHelpers';\n\n/**\n * Renders the activity column with time since last post and active users\n */\nexport default class LastUsersColumn extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n    const latestPosters = discussion.attribute('latestPosters') || [];\n    \n    return m('div.discussion-users', [\n      m('div.active-users', latestPosters.slice(0, 5).map((user, i) => \n        renderUserAvatar(user, i)\n      ))\n    ]);\n  }\n}","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Link from 'flarum/common/components/Link';\nimport TopicColumn from './TopicColumn';\nimport ReplyColumn from './ReplyColumn';\nimport ViewColumn from './ViewColumn';\nimport ActivityColumn from './ActivityColumn';\nimport LastUsersColumn from './LastUsersColumn';\n\n/**\n * The main row component for discussions in the discussion list\n */\nexport default class CustomDiscussionRow extends Component {\n  view() {\n    const discussion = this.attrs.discussion;\n\n    return m(Link, {\n      className: 'discussion-row',\n      href: app.route.discussion(discussion),\n    }, [\n      m(TopicColumn, { discussion }),\n      m(LastUsersColumn, { discussion }),\n      m(ReplyColumn, { discussion }),\n      m(ViewColumn, { discussion }),\n      m(ActivityColumn, { discussion }),\n    ]);\n  }\n}\n","import Component from 'flarum/common/Component';\nimport app from 'flarum/forum/app';\n\n\n/**\n * Renders the header for the discussion list\n */\n\nexport default class DiscussionListHeader extends Component {\n  view() {\n    return (\n      <li className=\"CustomDiscussionList-header\">\n        <div className=\"DiscussionListItem-info topic\">\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.topic')}\n        </div>\n        <div className=\"DiscussionListItem-info replies\">\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.replies')}\n        </div>\n        <div className=\"DiscussionListItem-info views\">\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.views')}\n        </div>\n        <div className=\"DiscussionListItem-info activity\">\n          {app.translator.trans('vietvan-ca-flarum-themes.forum.custom-discussion-header.activity')}\n        </div>\n      </li>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Search'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/LogInModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/SelectDropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","import Component from 'flarum/common/Component';\nimport app from 'flarum/forum/app';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nimport SelectDropdown from 'flarum/common/components/SelectDropdown';\nimport listItems from 'flarum/common/helpers/listItems';\n\nexport default class CustomMobileDiscussionToolbar extends Component {\n  view() {\n    return (\n      <div className=\"CustomMobileDiscussionToolbar\">\n        {/* Toggle Discussion List Button */}\n        <div className=\"CustomMobileDiscussionToolbar-left\">\n          <span className=\"CustomMobileDiscussionToolbar-date\">{this.currentDate}</span>\n          {SelectDropdown.component(\n            {\n              buttonClassName: 'Button Button--text',\n              className: 'all-discussion-select',\n            },\n            this.getNavigationItems().toArray()\n          )}\n        </div>\n\n        {/* Start Discussion Button */}\n        <button\n          class=\"Button Button--primary CustomMobileDiscussionToolbar-button\"\n          type=\"button\"\n          aria-label=\"Start Discussion\"\n          onclick={() => this.newDiscussionAction()}\n        >\n          <i aria-hidden=\"true\" class=\"icon fas fa-edit Button-icon\"></i>\n          <span class=\"Button-label\">\n            {app.translator.trans('core.forum.index.start_discussion_button')}\n          </span>\n        </button>\n      </div>\n    );\n  }\n\n  getNavigationItems() {\n    const items = new ItemList();\n\n    // All Discussions\n    items.add(\n      'all-discussions',\n      LinkButton.component(\n        {\n          href: app.route('index'),\n          icon: 'fas fa-comments',\n        },\n        app.translator.trans('core.forum.index.all_discussions_link')\n      ),\n      100\n    );\n\n    // Tags\n    items.add(\n      'tags',\n      LinkButton.component(\n        {\n          href: app.route('tags'),\n          icon: 'fas fa-th-large',\n        },\n        app.translator.trans('flarum-tags.forum.index.tags_link')\n      ),\n      90\n    );\n\n    // Get all tags from the store\n    const allTags = app.store.all('tags');\n\n    if (allTags && allTags.length > 0) {\n      // Filter and sort primary tags\n      const primaryTags = allTags\n        .filter((tag) => {\n          // Only show primary tags (no parent)\n          const hasParent = tag.parent && tag.parent();\n          const position = tag.position();\n          // Include tags that don't have a parent and have a position\n          return !hasParent && position !== null && position !== undefined;\n        })\n        .sort((a, b) => a.position() - b.position());\n\n      // Add each tag to the dropdown\n      primaryTags.forEach((tag, index) => {\n        items.add(\n          `tag-${tag.id()}`,\n          LinkButton.component(\n            {\n              href: app.route('tag', { tags: tag.slug() }),\n              icon: 'fas fa-circle',\n              style: tag.color() ? { color: tag.color() } : {},\n            },\n            tag.name()\n          ),\n          80 - index\n        );\n      });\n    }\n\n    return items;\n  }\n\n  newDiscussionAction() {\n    return new Promise((resolve, reject) => {\n      if (app.session.user) {\n        app.composer.load(DiscussionComposer, { user: app.session.user });\n        app.composer.show();\n\n        return resolve(app.composer);\n      } else {\n        app.modal.show(LogInModal);\n\n        return reject();\n      }\n    });\n  }\n}\n","import Component from 'flarum/common/Component';\nimport Search from 'flarum/forum/components/Search';\nimport CustomMobileDiscussionToolbar from './CustomMobileDiscussionToolbar';\n\nexport default class HeroSection extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    const forum = app.forum;\n    // enabled?\n    this.enabled = forum.attribute('vietvan_ca_hero_enabled') === '1';\n    if (!this.enabled) return;\n\n    // Initial mode - start with light as default\n    this.mode = 'light';\n\n    // Setup listeners first\n    if (flarum.extensions['fof-nightmode']) {\n      this.setupNightModeListener();\n    }\n    this.setupSystemModeListener();\n    this.setupBodyClassObserver();\n\n    // Compute actual mode after a delay to ensure theme has initialized\n    setTimeout(() => {\n      this.mode = this.computeMode();\n      m.redraw();\n    }, 100);\n\n    // Re-check mode after a longer delay (in case FoF extension hasn't initialized yet)\n    setTimeout(() => {\n      const newMode = this.computeMode();\n      if (newMode !== this.mode) {\n        this.mode = newMode;\n        m.redraw();\n      }\n    }, 500);\n\n    // locale-specific text\n    this.locale = app.translator.getLocale() || 'en';\n    const titleKey = `vietvan_ca_hero_title_${this.locale}`;\n    const descKey = `vietvan_ca_hero_description_${this.locale}`;\n\n    this.title = forum.attribute(titleKey) ?? app.translator.trans('vietvan-ca-flarum-themes.forum.hero.title');\n    this.description = forum.attribute(descKey) ?? app.translator.trans('vietvan-ca-flarum-themes.forum.hero.description');\n\n    // show or hide text overlay?\n    this.showText = forum.attribute('vietvan_ca_hero_show_text') === '1';\n\n    // has custom text color?\n    this.hasCustomColor = forum.attribute('vietvan_ca_hero_custom_color_enabled') === '1';\n    this.titleStyle = {};\n    this.descriptionStyle = {};\n\n    if (this.hasCustomColor) {\n      const titleColor = forum.attribute('vietvan_ca_hero_title_color') || '#ffffff';\n      const subtitleColor = forum.attribute('vietvan_ca_hero_subtitle_color') || '#ffffff';\n\n      this.titleStyle = { color: titleColor };\n      this.descriptionStyle = { color: subtitleColor };\n    }\n  }\n\n  computeMode() {\n    // First, check if FoF Night Mode is active by checking the body class\n    // This is the most reliable way to detect actual dark mode state\n    if (document.body.classList.contains('flarum--night')) {\n      return 'dark';\n    }\n\n    // Check if user is logged in\n    const user = app.session.user;\n\n    if (user) {\n      // Logged in: use user preference from FoF Night Mode\n      const pref = user.preferences().fofNightMode;\n      // FoF Night Mode stores as integers: 0 = auto, 1 = light, 2 = dark\n      if (pref === 2 || pref === '2') return 'dark';\n      if (pref === 1 || pref === '1') return 'light';\n      if (pref === 0 || pref === '0' || pref === null || pref === undefined) {\n        // For auto/null preferences, default to light mode (respecting our default theme setting)\n        // Only use system preference if user explicitly wants auto mode\n        const isExplicitAuto = pref === 0 || pref === '0';\n        if (isExplicitAuto) {\n          return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n        }\n        // Default to light for null/undefined (new users)\n        return 'light';\n      }\n      return 'light';\n    }\n\n    // Guest: check cookie\n    const cookieValue = document.cookie\n      .split('; ')\n      .find((row) => row.startsWith('flarum_nightmode='))\n      ?.split('=')[1];\n\n    if (cookieValue === '2') return 'dark';\n    if (cookieValue === '1') return 'light';\n    if (cookieValue === '0') {\n      // Explicit system preference\n      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    }\n    \n    // No cookie found - default to light mode (respecting our default theme setting)\n    return 'light';\n  }\n\n  setupNightModeListener() {\n    this.nightModeHandler = (event) => {\n      this.mode = event.detail === 'day' ? 'light' : 'dark';\n      m.redraw();\n    };\n    document.addEventListener('fofnightmodechange', this.nightModeHandler);\n  }\n\n  setupSystemModeListener() {\n    // Listen to OS-level dark mode changes\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    this.systemModeHandler = (e) => {\n      const newMode = this.computeMode();\n      if (newMode !== this.mode) {\n        this.mode = newMode;\n        m.redraw();\n      }\n    };\n    mediaQuery.addEventListener('change', this.systemModeHandler);\n  }\n\n  setupBodyClassObserver() {\n    // Watch for changes to body class (when FoF Night Mode toggles)\n    this.bodyObserver = new MutationObserver(() => {\n      const newMode = this.computeMode();\n      if (newMode !== this.mode) {\n        this.mode = newMode;\n        m.redraw();\n      }\n    });\n\n    this.bodyObserver.observe(document.body, {\n      attributes: true,\n      attributeFilter: ['class'],\n    });\n  }\n\n  onremove() {\n    // Clean up listeners\n    if (this.nightModeHandler) {\n      document.removeEventListener('fofnightmodechange', this.nightModeHandler);\n    }\n    if (this.systemModeHandler) {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      mediaQuery.removeEventListener('change', this.systemModeHandler);\n    }\n    if (this.bodyObserver) {\n      this.bodyObserver.disconnect();\n    }\n  }\n\n  getBackgroundStyle() {\n    const forum = app.forum;\n    const bgAttr = this.mode === 'dark' ? 'vietvan_ca_hero_background_image_darkUrl' : 'vietvan_ca_hero_background_imageUrl';\n    const bgUrl = forum.attribute(bgAttr);\n\n    return bgUrl\n      ? {\n          height: '35vh',\n          backgroundImage: `url(${bgUrl})`,\n          backgroundPosition: 'center',\n          backgroundSize: 'cover',\n          backgroundRepeat: 'no-repeat',\n        }\n      : undefined;\n  }\n\n  view() {\n    // Don't render if not enabled\n    if (!this.enabled) return null;\n\n    // Only show on the homepage (root path)\n    const currentPath = window.location.pathname;\n    if (currentPath !== '/' && currentPath !== '') return null;\n\n    // Get background style dynamically on each render\n    const backgroundStyle = this.getBackgroundStyle();\n\n    return (\n      <div className=\"HeroSection\" style={backgroundStyle}>\n        {this.showText && (\n          <div className=\"container\">\n            <h1 className=\"HeroSection-title\" style={this.titleStyle}>\n              {this.title}\n            </h1>\n            <p className=\"HeroSection-subtitle\" style={this.descriptionStyle}>\n              {this.description}\n            </p>\n          </div>\n        )}\n        <div className=\"container\">\n          <Search state={app.search} />\n        </div>\n      </div>\n    );\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\n\nexport default class Logo extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.mode = app.session.user?.preferences().fofNightMode === 2 ? 'dark' : 'light';\n    \n    if (flarum.extensions['fof-nightmode']) {\n      this.setupNightModeListener();\n    }\n  }\n\n  setupNightModeListener() {\n    document.addEventListener('fofnightmodechange', (event) => {\n      this.mode = event.detail === 'day' ? 'light' : 'dark';\n      m.redraw();\n    });\n  }\n\n  view(vnode) {\n    const logoAttr = this.mode === 'dark' ? 'vietvan_ca_logo_darkUrl' : 'vietvan_ca_logoUrl';\n    const logoUrl = app.forum.attribute(logoAttr);\n\n    if (!logoUrl) return null;\n\n    const customUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || app.route('index');\n    const imageStyle = vnode.attrs.imageStyle || {};\n\n    return (\n      <a href={customUrl} className=\"Header-logo CustomHeaderLogo\">\n        <img src={logoUrl} alt={'VietVan CA'} style={imageStyle} />\n      </a>\n    );\n  }\n}\n","import Component from 'flarum/common/Component';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport app from 'flarum/forum/app';\n\nexport default class CustomDiscussionTabNavigation extends Component {\n  view() {\n    const currentSort = app.search.params()?.sort;\n\n    const tabs = [\n      { key: 'latest', label: app.translator.trans('core.forum.index_sort.latest_button'), sortParam: '', default: true },\n      { key: 'top', label: app.translator.trans('core.forum.index_sort.top_button'), sortParam: 'top' },\n      { key: 'newest', label: app.translator.trans('core.forum.index_sort.newest_button'), sortParam: 'newest' },\n      { key: 'oldest', label: app.translator.trans('core.forum.index_sort.oldest_button'), sortParam: 'oldest' },\n    ];\n\n    return (\n      <div className=\"CustomDiscussionTabNavigation\">\n        {tabs.map((tab) => {\n          let isActive = false;\n          if (tab.routeName) {\n            isActive = app.current.matches(tab.routeName);\n          } else if (tab.isFilter) {\n            isActive = app.search.params.q && app.search.params.q.includes(tab.filterParam);\n          } else {\n            isActive = currentSort === tab.sortParam || (!currentSort && tab.default);\n          }\n\n          return (\n            <LinkButton className={`SortItem Button Button--link ${isActive ? 'active' : ''}`} onclick={() => this.navigateTo(tab)}>\n              {tab.label}\n            </LinkButton>\n          );\n        })}\n      </div>\n    );\n  }\n\n  navigateTo(tab) {\n    // 1. Get the current URL path (e.g., /t/general?sort=newest)\n    const currentPath = m.route.get();\n\n    // 2. Remove any existing query parameters by splitting the string at the '?'\n    const basePath = currentPath.split('?')[0]; // Result: /t/general\n\n    // 3. Build the new URL path string\n    let newPath = basePath;\n    if (!tab.default) {\n      // Add the sort parameter if this tab is not the default one\n      newPath += '?sort=' + tab.sortParam;\n    }\n\n    // 4. Use m.route.set() to navigate to the new URL without a full page reload\n    m.route.set(newPath);\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport listItems from 'flarum/common/helpers/listItems';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport Logo from './Logo';\n\n/**\n * Helper to get translation with fallback\n */\nfunction trans(key, fallback) {\n  const result = app.translator.trans(`vietvan-ca-flarum-themes.forum.mobile_drawer.${key}`);\n  if (result && result !== `vietvan-ca-flarum-themes.forum.mobile_drawer.${key}`) {\n    return result;\n  }\n  return fallback;\n}\n\n/**\n * Custom Mobile Drawer component that matches VietVan main website sidebar\n */\nexport default class CustomMobileDrawer extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n\n  view() {\n    return (\n      <div>\n        {/* Toggle Button - Always visible, positioned outside drawer */}\n        <button \n          className=\"CustomMobileDrawer-toggleBtn\"\n          onclick={() => this.toggleDrawer()}\n        >\n          <i className=\"fas fa-bars\"></i>\n        </button>\n\n        <div className=\"CustomMobileDrawer\">\n          {/* Logo Section */}\n          <div className=\"CustomMobileDrawer-logo\">\n            <Logo imageStyle={{ height: '40px' }} />\n          </div>\n\n          {/* Navigation Menu */}\n          <nav className=\"CustomMobileDrawer-nav\">\n            <ul className=\"CustomMobileDrawer-menu\">\n              {listItems(this.menuItems().toArray())}\n            </ul>\n          </nav>\n\n          {/* Separator */}\n          <div className=\"CustomMobileDrawer-separator\"></div>\n\n          {/* Auth Section */}\n          <div className=\"CustomMobileDrawer-auth\">\n            {app.session.user ? this.loggedInSection() : this.guestSection()}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Build menu items for navigation\n   */\n  menuItems() {\n    const items = new ItemList();\n    const mainSiteUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || app.forum.attribute('baseUrl').replace('/forum', '');\n\n    // Trang Ch (Home)\n    items.add('home',\n      <li className=\"CustomMobileDrawer-menuItem\">\n        <a href={mainSiteUrl} className=\"CustomMobileDrawer-link\">\n          {trans('home', 'Trang Ch')}\n        </a>\n      </li>,\n      100\n    );\n\n    // Din n (Forum) - Active\n    items.add('forum',\n      <li className=\"CustomMobileDrawer-menuItem active\">\n        <a href={app.forum.attribute('baseUrl')} className=\"CustomMobileDrawer-link\">\n          {trans('forum', 'Din n')}\n        </a>\n      </li>,\n      90\n    );\n\n    // Lu  (Notes/Guidelines)\n    const guidelinesTag = this.findTagBySlug('luu-y') || this.findTagBySlug('guidelines');\n    if (guidelinesTag) {\n      items.add('guidelines',\n        <li className=\"CustomMobileDrawer-menuItem\">\n          <a href={app.route('tag', { tags: guidelinesTag.slug() })} className=\"CustomMobileDrawer-link\">\n            {trans('guidelines', 'Lu ')}\n          </a>\n        </li>,\n        80\n      );\n    }\n\n    // Language Selector\n    items.add('language',\n      <li className=\"CustomMobileDrawer-menuItem CustomMobileDrawer-menuItem--dropdown\">\n        {this.languageDropdown()}\n      </li>,\n      70\n    );\n\n    // Theme/Appearance Toggle\n    items.add('theme',\n      <li className=\"CustomMobileDrawer-menuItem CustomMobileDrawer-menuItem--dropdown\">\n        {this.themeToggle()}\n      </li>,\n      60\n    );\n\n    return items;\n  }\n\n  /**\n   * Find a tag by its slug\n   */\n  findTagBySlug(slug) {\n    if (!app.store || !app.store.all) return null;\n    \n    const tags = app.store.all('tags');\n    return tags.find(tag => tag.slug() === slug);\n  }\n\n  /**\n   * Language dropdown selector\n   */\n  languageDropdown() {\n    // Check if fof/linguist or flarum/lang-ext is available\n    const locales = app.data.locales || {};\n    const currentLocale = app.data.locale || 'en';\n    \n    if (Object.keys(locales).length <= 1) {\n      // Only one locale, just show current language\n      return (\n        <div className=\"CustomMobileDrawer-languageDisplay\">\n          <span className=\"CustomMobileDrawer-link\">\n            {this.getLocaleName(currentLocale)}\n            <i className=\"fas fa-globe CustomMobileDrawer-icon\"></i>\n          </span>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"CustomMobileDrawer-dropdown\">\n        <button \n          className=\"CustomMobileDrawer-link CustomMobileDrawer-dropdownTrigger\"\n          onclick={(e) => this.toggleDropdown(e, 'language')}\n        >\n          {this.getLocaleName(currentLocale)}\n          <i className=\"fas fa-chevron-down CustomMobileDrawer-chevron\"></i>\n        </button>\n        <ul className=\"CustomMobileDrawer-dropdownMenu\" id=\"language-dropdown\">\n          {Object.keys(locales).map(locale => (\n            <li key={locale}>\n              <a \n                href=\"javascript:void(0)\" \n                onclick={() => this.changeLocale(locale)}\n                className={currentLocale === locale ? 'active' : ''}\n              >\n                {locales[locale]}\n              </a>\n            </li>\n          ))}\n        </ul>\n      </div>\n    );\n  }\n\n  /**\n   * Get locale display name\n   */\n  getLocaleName(locale) {\n    const names = {\n      'en': 'English',\n      'vi': 'Ting Vit'\n    };\n    return names[locale] || app.data.locales?.[locale] || locale;\n  }\n\n  /**\n   * Change locale\n   */\n  changeLocale(locale) {\n    if (app.session.user) {\n      app.session.user.savePreferences({ locale }).then(() => {\n        window.location.reload();\n      });\n    } else {\n      document.cookie = `locale=${locale};path=/;max-age=${60 * 60 * 24 * 365}`;\n      window.location.reload();\n    }\n  }\n\n  /**\n   * Theme toggle button\n   */\n  themeToggle() {\n    return (\n      <button \n        className=\"CustomMobileDrawer-link\"\n        onclick={() => this.toggleTheme()}\n      >\n        <i className=\"fas fa-cog CustomMobileDrawer-icon--left\"></i>\n        {trans('appearance', 'Giao Din')}\n      </button>\n    );\n  }\n\n  /**\n   * Toggle theme (if night mode extension is available)\n   */\n  toggleTheme() {\n    // Try to trigger FoF NightMode\n    const nightModeToggle = document.querySelector('.item-nightMode button, .NightMode-toggle');\n    if (nightModeToggle) {\n      nightModeToggle.click();\n    } else {\n      // Fallback: toggle dark class on body\n      document.body.classList.toggle('dark');\n      const isDark = document.body.classList.contains('dark');\n      localStorage.setItem('fofNightMode', isDark ? 'dark' : 'light');\n    }\n  }\n\n  /**\n   * Toggle dropdown visibility\n   */\n  toggleDropdown(e, dropdownId) {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    const dropdown = document.getElementById(`${dropdownId}-dropdown`);\n    if (dropdown) {\n      dropdown.classList.toggle('open');\n    }\n  }\n\n  /**\n   * Guest section with login/register buttons and social login\n   */\n  guestSection() {\n    const mainSiteUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || '';\n    const baseMainUrl = mainSiteUrl ? mainSiteUrl.replace('/forum', '').replace(/\\/$/, '') : '';\n    \n    // Use external register URL but Flarum login for SSO\n    const registerUrl = `${baseMainUrl}/auth/register`;\n\n    return (\n      <div className=\"CustomMobileDrawer-guest\">\n        {/* Register Button */}\n        <a href={registerUrl} className=\"Button Button--primary CustomMobileDrawer-registerBtn\">\n          {trans('register', 'ng k')}\n        </a>\n\n        {/* Login Button - Use Flarum's default login (SSO compatible) */}\n        <button \n          className=\"Button Button--secondary CustomMobileDrawer-loginBtn\"\n          onclick={() => this.showLoginModal()}\n        >\n          {trans('login', 'ng nhp')}\n        </button>\n\n        {/* Social Login Separator */}\n        <div className=\"CustomMobileDrawer-socialSeparator\">\n          <span>{trans('or', 'Hoc:')}</span>\n        </div>\n\n        {/* Social Login Buttons */}\n        <div className=\"CustomMobileDrawer-socialButtons\">\n          <button \n            className=\"Button CustomMobileDrawer-socialBtn CustomMobileDrawer-socialBtn--facebook\"\n            onclick={() => this.socialLogin('facebook')}\n          >\n            <i className=\"fab fa-facebook CustomMobileDrawer-socialIcon\"></i>\n            {trans('login_facebook', 'ng nhp bng Facebook')}\n          </button>\n\n          <button \n            className=\"Button CustomMobileDrawer-socialBtn CustomMobileDrawer-socialBtn--google\"\n            onclick={() => this.socialLogin('google')}\n          >\n            <img src=\"https://www.google.com/favicon.ico\" alt=\"Google\" className=\"CustomMobileDrawer-socialIcon CustomMobileDrawer-socialIcon--img\" />\n            {trans('login_google', 'ng nhp bng Google')}\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Handle social login with dual-platform authentication\n   * Uses popup window for OAuth flow\n   */\n  socialLogin(provider) {\n    // Get backend API URL from Flarum settings or use default\n    const backendUrl = app.forum.attribute('jwt-sso.backendApiUrl') || 'https://api.vietvan.ca';\n    \n    if (!backendUrl) {\n      console.error('Backend API URL not configured for social login');\n      alert('Social login is not properly configured. Please contact the administrator.');\n      return;\n    }\n\n    // Close the mobile drawer first\n    const drawer = document.querySelector('.vietvan-mobile-drawer');\n    if (drawer) {\n      drawer.style.right = '-100%';\n      document.body.classList.remove('vietvan-drawer-open');\n    }\n\n    // Generate state parameter for security\n    const state = this.generateRandomString(32);\n\n    // Build the OAuth URL - backend will handle the redirect to Google\n    const returnUrl = encodeURIComponent(`${window.location.origin}/auth/sso/callback`);\n    const oauthUrl = `${backendUrl}/api/flarum-auth/${provider}?return_url=${returnUrl}&state=${state}`;\n    \n    console.log('Starting dual-platform OAuth flow:', oauthUrl);\n    \n    // Open popup window for OAuth\n    const popup = window.open(\n      oauthUrl,\n      `${provider}_login`,\n      'width=500,height=600,scrollbars=yes,resizable=yes,left=' + (screen.width / 2 - 250) + ',top=' + (screen.height / 2 - 300)\n    );\n\n    if (!popup) {\n      alert('Popup b chn. Vui lng cho php popup v th li.');\n      return;\n    }\n\n    // Focus the popup\n    popup.focus();\n  }\n\n  /**\n   * Logged in user section with enhanced identity display\n   */\n  loggedInSection() {\n    const user = app.session.user;\n    const mainSiteUrl = app.forum.attribute('vietvan_ca_back_button_custom_url') || '';\n    const baseMainUrl = mainSiteUrl ? mainSiteUrl.replace('/forum', '').replace(/\\/$/, '') : '';\n\n    return (\n      <div className=\"CustomMobileDrawer-user\">\n        {/* Enhanced User Identity Section */}\n        <div className=\"CustomMobileDrawer-userIdentity\">\n          <div className=\"CustomMobileDrawer-avatar CustomMobileDrawer-avatar--default\">\n            {user.avatarUrl() ? (\n              <img src={user.avatarUrl()} alt={user.displayName()} />\n            ) : (\n              <i className=\"fas fa-user\"></i>\n            )}\n          </div>\n          <div className=\"CustomMobileDrawer-userName\">\n            <span className=\"CustomMobileDrawer-displayName\">{user.displayName()}</span>\n            <a href={app.route('settings')} className=\"CustomMobileDrawer-accountSettingsBtn\">\n              {trans('account_settings', 'Ci t ti khon')}\n            </a>\n          </div>\n        </div>\n\n        {/* User Menu - Updated with requested items */}\n        <ul className=\"CustomMobileDrawer-userMenu\">\n          <li>\n            <a href={`${baseMainUrl}/manage-listings/posts/create`} className=\"CustomMobileDrawer-link\">\n              <i className=\"fas fa-edit CustomMobileDrawer-icon--left\"></i>\n              {trans('create_post', 'ng tin')}\n            </a>\n          </li>\n          <li>\n            <a href={`${baseMainUrl}/manage-listings`} className=\"CustomMobileDrawer-link\">\n              <i className=\"fas fa-list-alt CustomMobileDrawer-icon--left\"></i>\n              {trans('manage_posts', 'Qun l tin ng')}\n            </a>\n          </li>\n          <li>\n            <a href={`${baseMainUrl}/contact`} className=\"CustomMobileDrawer-link\">\n              <i className=\"fas fa-envelope CustomMobileDrawer-icon--left\"></i>\n              {trans('contact', 'Lin H')}\n            </a>\n          </li>\n          <li>\n            <button \n              className=\"CustomMobileDrawer-link CustomMobileDrawer-logout\"\n              onclick={() => this.logout()}\n            >\n              <i className=\"fas fa-sign-out-alt CustomMobileDrawer-icon--left\"></i>\n              {trans('logout', 'ng xut')}\n            </button>\n          </li>\n        </ul>\n      </div>\n    );\n  }\n\n  /**\n   * Toggle the mobile drawer visibility\n   */\n  toggleDrawer() {\n    const drawer = document.querySelector('.vietvan-mobile-drawer');\n    if (drawer) {\n      const isOpen = drawer.style.right === '0px';\n      drawer.style.right = isOpen ? '-100%' : '0px';\n      document.body.classList.toggle('vietvan-drawer-open', !isOpen);\n      console.log('Drawer toggled:', !isOpen);\n    }\n  }\n\n  /**\n   * Show Flarum's default login (SSO compatible)\n   */\n  showLoginModal() {\n    // Close the mobile drawer first\n    const drawer = document.querySelector('.vietvan-mobile-drawer');\n    if (drawer) {\n      drawer.style.right = '-100%';\n      document.body.classList.remove('vietvan-drawer-open');\n    }\n\n    // Find and click the default Flarum login button to trigger SSO\n    const defaultLoginButton = document.querySelector('.Header-controls .item-logIn button, .HeaderSecondary .item-logIn button, .item-logIn .Button');\n    \n    if (defaultLoginButton) {\n      console.log('Triggering default Flarum login (SSO compatible)');\n      defaultLoginButton.click();\n    } else {\n      // Fallback: Show Flarum's login modal if no SSO button found\n      console.log('No SSO button found, showing login modal');\n      app.modal.show(LogInModal);\n    }\n  }\n\n  /**\n   * Handle logout\n   */\n  logout() {\n    const confirmMessage = trans('logout_confirm', 'Bn c chc chn mun ng xut?');\n    if (confirm(confirmMessage)) {\n      app.session.logout();\n    }\n  }\n\n  /**\n   * Generate a random string for OAuth state parameter\n   */\n  generateRandomString(length) {\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let result = '';\n    for (let i = 0; i < length; i++) {\n      result += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return result;\n  }\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport LogInModal from 'flarum/forum/components/LogInModal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport TextEditor from 'flarum/common/components/TextEditor';\n\n/**\n * Custom Mobile Create Topic Modal\n * A full-page mobile-optimized modal for creating new topics\n */\nexport default class CustomMobileCreateModal extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n    \n    this.title = '';\n    this._content = '';\n    this.selectedTag = '';\n    this.isSubmitting = false;\n  }\n\n  view() {\n    if (window.innerWidth > 768) return null; // Desktop only shows default composer\n\n    return (\n      <div className={`CustomMobileCreateModal ${this.isVisible() ? 'visible' : ''} ${document.body.classList.contains('dark') ? 'dark' : ''}`}>\n        {/* Header */}\n        <div className=\"CustomMobileCreateModal-header\">\n          <h2>To ch  mi</h2>\n          <button \n            className=\"close-btn\"\n            onclick={() => this.hide()}\n            type=\"button\"\n          >\n            <i className=\"fas fa-times\"></i>\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"CustomMobileCreateModal-content\">\n          {/* Tags Selection */}\n          <div className=\"form-group\">\n            <label>Chn ch  (ty chn):</label>\n            <select \n              value={this.selectedTag}\n              onchange={(e) => { this.selectedTag = e.target.value; }}\n            >\n              <option value=\"\">-- Chn ch  --</option>\n              {this.getTagOptions()}\n            </select>\n          </div>\n\n          {/* Title Input */}\n          <div className=\"form-group\">\n            <label>Tiu :</label>\n            <input \n              type=\"text\" \n              placeholder=\"Nhp tiu  bi vit...\"\n              value={this.title}\n              oninput={(e) => { this.title = e.target.value; }}\n            />\n          </div>\n\n          {/* Content Editor */}\n          <div className=\"form-group\">\n            <label>Ni dung (ty chn):</label>\n            <div className=\"TextEditor-container\">\n              <TextEditor\n                className=\"TextEditor--mobile\"\n                placeholder=\"Vit ni dung bi vit (khng bt buc)...\"\n                value={this.getContent()}\n                oninput={(value) => this.setContent(value)}\n                onupdate={() => {\n                  setTimeout(() => this.configureDirectUpload(), 150);\n                }}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"CustomMobileCreateModal-footer\">\n          <button \n            className=\"submit-btn\"\n            onclick={() => this.submit()}\n            disabled={this.isSubmitting || !this.canSubmit()}\n            type=\"button\"\n          >\n            {this.isSubmitting ? 'ang ng...' : 'ng'}\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  getTagOptions() {\n    const tags = app.store.all('tags');\n    return tags\n      .filter(tag => !tag.parent() && tag.canStartDiscussion())\n      .map(tag => (\n        <option value={tag.id()}>{tag.name()}</option>\n      ));\n  }\n\n  getContent() {\n    // Use stored content value\n    return this._content || '';\n  }\n\n  setContent(value) {\n    // Store the content value\n    this._content = value;\n  }\n\n  configureDirectUpload() {\n    // Add safety check to prevent errors\n    if (!document.querySelector('.CustomMobileCreateModal')) {\n      return; // Modal not ready yet\n    }\n    \n    // Wait for toolbar to be rendered\n    setTimeout(() => {\n      const editorContainer = document.querySelector('.CustomMobileCreateModal .TextEditor-container');\n      if (!editorContainer) return;\n\n      // Hide gallery/media selection buttons but keep direct upload\n      const buttonsToHide = [\n        // File manager gallery buttons\n        '.Button--icon[title*=\"Media Gallery\"]',\n        '.Button--icon[title*=\"Gallery\"]', \n        '.Button--icon[data-tooltip*=\"Gallery\"]',\n        '.Button--icon[data-tooltip*=\"Media\"]',\n        '.Button--icon[aria-label*=\"Gallery\"]',\n        // FoF Upload gallery button\n        'button[class*=\"fof-upload-gallery\"]',\n        'button[title*=\"Choose from gallery\"]',\n        '.Button[data-tooltip*=\"Choose from gallery\"]'\n      ];\n\n      buttonsToHide.forEach(selector => {\n        const elements = editorContainer.querySelectorAll(selector);\n        elements.forEach(el => {\n          if (el && el.style) {\n            el.style.display = 'none';\n            el.style.visibility = 'hidden';\n            try {\n              if (el.parentNode) {\n                el.parentNode.removeChild(el);\n              }\n            } catch (e) {\n              // Ignore removal errors\n            }\n          }\n        });\n      });\n\n      // Ensure direct upload button is visible and styled properly\n      const uploadButtons = editorContainer.querySelectorAll([\n        '.Button--icon[title*=\"Upload\"]',\n        '.Button--icon[data-tooltip*=\"Upload\"]', \n        'button[class*=\"fof-upload-button\"]:not([class*=\"gallery\"])',\n        '.item-fof-upload .Button'\n      ].join(','));\n\n      uploadButtons.forEach(btn => {\n        if (btn && !btn.textContent.toLowerCase().includes('gallery')) {\n          btn.style.display = 'inline-block';\n          btn.style.visibility = 'visible';\n          // Add direct upload styling\n          btn.classList.add('Button--direct-upload');\n          \n          // If it's a file input, make it direct\n          const fileInput = btn.querySelector('input[type=\"file\"]');\n          if (fileInput) {\n            fileInput.accept = 'image/*,video/*,audio/*,application/pdf,.doc,.docx,.txt';\n            fileInput.multiple = false; // Single file upload for simplicity\n          }\n        }\n      });\n\n      // Style the upload area for mobile\n      const toolbar = editorContainer.querySelector('.TextEditor-toolbar');\n      if (toolbar) {\n        toolbar.classList.add('TextEditor-toolbar--mobile-direct');\n      }\n\n      // Add improved upload handling for direct upload\n      this.enhanceDirectUpload(editorContainer);\n    }, 100);\n  }\n\n  enhanceDirectUpload(container) {\n    if (!container) return;\n    \n    // Find upload buttons and enhance them for direct upload\n    const uploadButtons = container.querySelectorAll('.Button--icon, .fof-upload-button');\n    \n    uploadButtons.forEach(btn => {\n      try {\n        const fileInput = btn.querySelector('input[type=\"file\"]') || btn.previousElementSibling;\n        \n        if (fileInput && fileInput.type === 'file') {\n          // Ensure direct upload behavior\n          fileInput.accept = 'image/*,video/*,audio/*,application/pdf,.doc,.docx,.txt';\n          fileInput.multiple = false;\n          \n          // Add direct upload handler\n          const originalHandler = fileInput.onchange;\n          fileInput.onchange = (e) => {\n            const file = e.target.files[0];\n            if (file) {\n              // Show upload feedback\n              if (btn.style) {\n                btn.style.opacity = '0.7';\n                btn.style.pointerEvents = 'none';\n              }\n              \n              // Call original handler if exists, otherwise handle directly\n              if (originalHandler) {\n                originalHandler.call(fileInput, e);\n              } else {\n                this.handleDirectUpload(file, btn);\n              }\n              \n              // Reset button after upload\n              setTimeout(() => {\n                if (btn.style) {\n                  btn.style.opacity = '1';\n                  btn.style.pointerEvents = 'auto';\n                }\n              }, 2000);\n            }\n          };\n        }\n      } catch (error) {\n        // Ignore individual button enhancement errors\n        console.warn('Error enhancing upload button:', error);\n      }\n    });\n  }\n\n  handleDirectUpload(file, button) {\n    // Basic direct upload handling\n    console.log('Direct upload:', file.name);\n    \n    // You can add custom upload logic here if needed\n    // For now, let Flarum's default upload system handle it\n    if (app.alerts) {\n      app.alerts.show({ type: 'success' }, `ang ti ln: ${file.name}...`);\n    }\n  }\n\n  canSubmit() {\n    return this.title.trim() && \n           app.session.user && \n           app.forum.attribute('canStartDiscussion');\n  }\n\n  isVisible() {\n    return document.body.classList.contains('mobile-create-modal-open');\n  }\n\n  show() {\n    if (window.innerWidth <= 768) {\n      // Check if user can start discussions\n      if (!app.session.user) {\n        app.modal.show(LogInModal);\n        return;\n      }\n      \n      if (!app.forum.attribute('canStartDiscussion')) {\n        if (app.alerts) {\n          app.alerts.show({ type: 'error' }, 'Bn khng c quyn to ch  mi');\n        }\n        return;\n      }\n      \n      document.body.classList.add('mobile-create-modal-open');\n      \n      // Hide any existing Flarum composer\n      const composer = document.querySelector('#composer');\n      if (composer) {\n        composer.style.display = 'none';\n      }\n      \n      m.redraw();\n    }\n  }\n\n  hide() {\n    document.body.classList.remove('mobile-create-modal-open');\n    this.title = '';\n    this._content = '';\n    this.setContent('');\n    this.selectedTag = '';\n    this.isSubmitting = false;\n    m.redraw();\n  }\n\n  submit() {\n    if (!this.canSubmit() || this.isSubmitting) return;\n\n    this.isSubmitting = true;\n    m.redraw();\n\n    // Use Flarum's request system to submit data\n    const requestData = {\n      data: {\n        type: 'discussions',\n        attributes: {\n          title: this.title,\n          content: this.getContent().trim() || ' ' // Ensure there's at least a space if content is empty\n        }\n      }\n    };\n\n    // Add tags relationship if selected\n    if (this.selectedTag) {\n      requestData.data.relationships = {\n        tags: {\n          data: [{ type: 'tags', id: this.selectedTag }]\n        }\n      };\n    }\n\n    app.request({\n      method: 'POST',\n      url: app.forum.attribute('apiUrl') + '/discussions',\n      body: requestData\n    }).then((response) => {\n      // Success - navigate to the new discussion  \n      const discussion = app.store.pushPayload(response);\n      window.location.href = app.route.discussion(discussion);\n      this.hide();\n    }).catch((error) => {\n      // Error handling\n      console.error('Failed to create discussion:', error);\n      \n      // Show error message\n      let errorMessage = 'C li xy ra khi ng bi';\n      if (error && error.errors && error.errors.length > 0) {\n        errorMessage = error.errors[0].detail || errorMessage;\n      }\n      \n      if (app.alerts) {\n        app.alerts.show({ type: 'error' }, errorMessage);\n      } else {\n        alert(errorMessage);\n      }\n    }).finally(() => {\n      this.isSubmitting = false;\n      m.redraw();\n    });\n  }\n\n  static show() {\n    // Only on mobile\n    if (window.innerWidth > 768) return;\n    \n    // Hide any existing Flarum composer immediately \n    const composer = document.querySelector('#composer');\n    if (composer) {\n      composer.style.display = 'none';\n    }\n\n    // Mount the component if not already mounted\n    let container = document.querySelector('#mobile-create-modal-container');\n    if (!container) {\n      container = document.createElement('div');\n      container.id = 'mobile-create-modal-container';\n      document.body.appendChild(container);\n      m.mount(container, CustomMobileCreateModal);\n    }\n\n    // Show the modal\n    document.body.classList.add('mobile-create-modal-open');\n    m.redraw();\n  }\n\n  static hide() {\n    document.body.classList.remove('mobile-create-modal-open');\n    m.redraw();\n  }\n}","import app from 'flarum/forum/app';\nimport CustomMobileCreateModal from './CustomMobileCreateModal';\n\n/**\n * Custom Mobile Composer Controller\n * Intercepts create topic clicks on mobile and shows custom modal\n */\nexport default class CustomMobileComposer {\n  static init() {\n    // Intercept create topic button clicks on mobile\n    this.interceptCreateTopicButtons();\n\n    // Mount the modal component\n    setTimeout(() => {\n      this.mountModal();\n    }, 1000);\n  }\n\n  static interceptCreateTopicButtons() {\n    // Use event delegation to catch all create topic button clicks\n    document.addEventListener('click', (e) => {\n      // Only on mobile\n      if (window.innerWidth > 768) return;\n\n      // More aggressive button detection\n      const target = e.target.closest('button, a, .Button');\n      \n      if (!target) return;\n\n      // Check various ways to identify create topic buttons\n      const buttonSelectors = [\n        '.CustomMobileDiscussionToolbar-button',\n        '.item-newDiscussion',\n        '.IndexPage-newDiscussion', \n        '.Button--primary[aria-label*=\"Start\"]',\n        '[title*=\"discussion\"]',\n        '[data-original-title*=\"discussion\"]'\n      ];\n\n      const isCreateButton = buttonSelectors.some(selector => target.matches(selector)) ||\n                             target.querySelector('.fa-edit, .fa-plus, .fa-pen') ||\n                             target.textContent.includes('Start') ||\n                             target.textContent.includes('discussion') ||\n                             target.textContent.includes('To') ||\n                             target.textContent.includes('Vit') ||\n                             target.getAttribute('aria-label')?.includes('Start') ||\n                             target.getAttribute('aria-label')?.includes('discussion');\n      \n      if (isCreateButton) {\n        e.preventDefault();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        \n        // Also prevent default composer from opening\n        setTimeout(() => {\n          const composer = document.querySelector('#composer');\n          if (composer) {\n            composer.remove();\n          }\n        }, 50);\n        \n        console.log('Intercepted create topic click on mobile');\n        CustomMobileCreateModal.show();\n        return false;\n      }\n    }, true); // Use capture phase for earlier interception\n\n    // Also hide any composer that appears on mobile\n    const observer = new MutationObserver((mutations) => {\n      if (window.innerWidth <= 768) {\n        mutations.forEach((mutation) => {\n          mutation.addedNodes.forEach((node) => {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n              if (node.id === 'composer' || node.querySelector('#composer')) {\n                console.log('Hiding default composer on mobile');\n                const composer = node.id === 'composer' ? node : node.querySelector('#composer');\n                composer.style.display = 'none';\n              }\n            }\n          });\n        });\n      }\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n\n    console.log('Create topic button interception initialized with aggressive blocking');\n  }\n\n  static mountModal() {\n    if (window.innerWidth <= 768 && !document.querySelector('#mobile-create-modal-container')) {\n      const container = document.createElement('div');\n      container.id = 'mobile-create-modal-container';\n      document.body.appendChild(container);\n      m.mount(container, CustomMobileCreateModal);\n      console.log('Mobile create modal mounted');\n    }\n  }\n}","/**\n * PageManager - Handles toolbar cleanup and loading state management\n * Addresses timing issues with CSS rules, dynamic changes, and stuck loading states\n */\n\nexport default class PageManager {\n  constructor() {\n    this.observers = new Map();\n    this.isProcessing = false;\n  }\n\n  /**\n   * Main cleanup function that hides unwanted toolbar elements\n   */\n  cleanup() {\n    if (this.isProcessing) return;\n    this.isProcessing = true;\n\n    try {\n      // Hide elements by specific attributes (most reliable)\n      this.hideByAttributes();\n      \n      // Hide elements by nth-child selectors (fallback)\n      this.hideByPosition();\n      \n      // Hide upload buttons (but preserve direct upload)\n      this.hideUploadButtons();\n      \n      // Hide gallery buttons specifically\n      this.hideGalleryButtons();\n      \n      // Hide rich text toggle\n      this.hideRichTextToggle();\n      \n      // Configure direct upload for remaining upload buttons\n      this.configureDirectUpload();\n      \n    } catch (error) {\n      console.warn('PageManager: Error during cleanup:', error);\n    } finally {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * Hide elements by data attributes and title attributes\n   */\n  hideByAttributes() {\n    const attributeSelectors = [\n      'button[data-hotkey=\"Ctrl+K\"]',\n      'button[title*=\"Link\"]',\n      'div[data-tooltip*=\"Link\"]',\n      'button[data-hotkey=\"Ctrl+>\"]', \n      'button[title*=\"Quote\"]',\n      'div[data-tooltip*=\"Quote\"]',\n      'button[data-hotkey=\"Ctrl+`\"]',\n      'button[title*=\"Code\"]',\n      'div[data-tooltip*=\"Code\"]'\n    ];\n\n    const toolbar = document.querySelector('.TextEditor-toolbar');\n    if (toolbar) {\n      attributeSelectors.forEach(selector => {\n        const elements = toolbar.querySelectorAll(selector);\n        elements.forEach(el => this.hideElement(el));\n      });\n    }\n  }\n\n  /**\n   * Hide elements by nth-child position (fallback method)\n   */\n  hideByPosition() {\n    const positionSelectors = [\n      '.TextEditor-toolbar > div > button:nth-child(4)',\n      '.TextEditor-toolbar > div > button:nth-child(5)',\n      '.TextEditor-toolbar > div > div:nth-child(1)',\n      '.TextEditor-toolbar > div > div:nth-child(6)',\n      '.TextEditor-toolbar > div > div:nth-child(7)',\n      '.TextEditor-toolbar > div > div:nth-child(10)'\n    ];\n\n    positionSelectors.forEach(selector => {\n      const elements = document.querySelectorAll(selector);\n      elements.forEach(el => this.hideElement(el));\n    });\n  }\n\n  /**\n   * Hide upload buttons\n   */\n  hideUploadButtons() {\n    const uploadSelectors = [\n      // Hide general upload items but keep direct upload functionality\n      '.item-fof-upload:not(.direct-upload)',\n      'li.item-fof-upload:not(.direct-upload)'\n    ];\n\n    uploadSelectors.forEach(selector => {\n      const elements = document.querySelectorAll(selector);\n      elements.forEach(el => this.hideElement(el));\n    });\n  }\n\n  /**\n   * Hide gallery buttons but keep direct upload\n   */\n  hideGalleryButtons() {\n    const gallerySelectors = [\n      // Gallery and media selection buttons\n      '.Button--icon[title*=\"Gallery\" i]',\n      '.Button--icon[data-tooltip*=\"Gallery\" i]',\n      '.Button--icon[aria-label*=\"Gallery\" i]',\n      '.Button--icon[title*=\"Media Gallery\" i]',\n      '.Button--icon[data-tooltip*=\"Media Gallery\" i]',\n      '.Button--icon[title*=\"Choose from gallery\" i]',\n      '.Button--icon[data-tooltip*=\"Choose from gallery\" i]',\n      'button[class*=\"gallery\"]',\n      '.fof-upload-gallery',\n      '.Button[data-tooltip*=\"Choose from gallery\" i]'\n    ];\n\n    gallerySelectors.forEach(selector => {\n      const elements = document.querySelectorAll(selector);\n      elements.forEach(el => {\n        this.hideElement(el);\n        // Also remove from DOM to prevent conflicts\n        if (el.parentNode) {\n          el.parentNode.removeChild(el);\n        }\n      });\n    });\n  }\n\n  /**\n   * Configure direct upload functionality\n   */\n  configureDirectUpload() {\n    try {\n      const textEditors = document.querySelectorAll('.TextEditor');\n      \n      textEditors.forEach(editor => {\n        const toolbar = editor.querySelector('.TextEditor-toolbar');\n        if (!toolbar || toolbar.classList.contains('configured-direct-upload')) return;\n        \n        toolbar.classList.add('configured-direct-upload');\n        \n        // Find and enhance upload buttons for direct upload\n        const uploadButtons = toolbar.querySelectorAll([\n          '.Button--icon[title*=\"Upload\" i]:not([title*=\"Gallery\" i])',\n          '.Button--icon[data-tooltip*=\"Upload\" i]:not([data-tooltip*=\"Gallery\" i])',\n          '.fof-upload-button:not(.fof-upload-gallery)',\n          'button[class*=\"upload\"]:not([class*=\"gallery\"])'\n        ].join(','));\n        \n        uploadButtons.forEach(btn => {\n          try {\n            if (btn.style && btn.style.display === 'none') {\n              btn.style.display = 'inline-block';\n              btn.style.visibility = 'visible';\n            }\n            \n            btn.classList.add('Button--direct-upload');\n            \n            // Enhance file input for direct upload\n            const fileInput = btn.querySelector('input[type=\"file\"]') || btn.nextElementSibling;\n            if (fileInput && fileInput.type === 'file') {\n              fileInput.accept = 'image/*,video/*,audio/*,application/pdf,.doc,.docx,.txt';\n              fileInput.multiple = false;\n              \n              // Add upload feedback\n              const originalChange = fileInput.onchange;\n              fileInput.onchange = (e) => {\n                const file = e.target.files[0];\n                if (file && btn.style) {\n                  btn.style.opacity = '0.7';\n                  if (app && app.alerts) {\n                    app.alerts.show({ type: 'success' }, `ang ti ln: ${file.name}...`);\n                  }\n                  \n                  setTimeout(() => {\n                    if (btn.style) {\n                      btn.style.opacity = '1';\n                    }\n                  }, 2000);\n                }\n                \n                if (originalChange) {\n                  originalChange.call(fileInput, e);\n                }\n              };\n            }\n          } catch (error) {\n            // Ignore individual button enhancement errors\n            console.warn('Error configuring upload button:', error);\n          }\n        });\n      });\n    } catch (error) {\n      console.warn('Error in configureDirectUpload:', error);\n    }\n  }\n\n  /**\n   * Hide rich text toggle button\n   */\n  hideRichTextToggle() {\n    const elements = document.querySelectorAll('.item-rich-text');\n    elements.forEach(el => this.hideElement(el));\n  }\n\n  /**\n   * Hide an element completely\n   * @param {Element} element \n   */\n  hideElement(element) {\n    if (!element || element.dataset.vietvanHidden) return;\n\n    // Mark as hidden to prevent repeated processing\n    element.dataset.vietvanHidden = 'true';\n    \n    // Apply multiple hiding methods for maximum effectiveness\n    element.style.setProperty('display', 'none', 'important');\n    element.style.setProperty('visibility', 'hidden', 'important');\n    element.style.setProperty('opacity', '0', 'important');\n    element.style.setProperty('pointer-events', 'none', 'important');\n    element.style.setProperty('height', '0', 'important');\n    element.style.setProperty('width', '0', 'important');\n    element.style.setProperty('overflow', 'hidden', 'important');\n    element.style.setProperty('margin', '0', 'important');\n    element.style.setProperty('padding', '0', 'important');\n    \n    // Add hidden class\n    element.classList.add('vietvan-hidden');\n    element.setAttribute('aria-hidden', 'true');\n    element.setAttribute('hidden', '');\n  }\n\n  /**\n   * Start observing for toolbar and loading changes\n   */\n  startObserving() {\n    // Observe composer area for toolbar creation/updates\n    const observeComposer = () => {\n      const composer = document.querySelector('#composer');\n      if (composer && !this.observers.has('composer')) {\n        const observer = new MutationObserver((mutations) => {\n          let needsCleanup = false;\n          \n          mutations.forEach(mutation => {\n            if (mutation.type === 'childList') {\n              // Check for toolbar-related additions\n              mutation.addedNodes.forEach(node => {\n                if (node.nodeType === Node.ELEMENT_NODE) {\n                  if (node.matches?.('.TextEditor-toolbar') || \n                      node.querySelector?.('.TextEditor-toolbar')) {\n                    needsCleanup = true;\n                  }\n                }\n              });\n            } else if (mutation.type === 'attributes') {\n              // Check for style/class changes that might affect toolbar\n              if (mutation.target.matches?.('.TextEditor-toolbar *')) {\n                needsCleanup = true;\n              }\n            }\n          });\n\n          if (needsCleanup) {\n            setTimeout(() => this.cleanup(), 50);\n          }\n        });\n\n        observer.observe(composer, {\n          childList: true,\n          subtree: true,\n          attributes: true,\n          attributeFilter: ['style', 'class', 'data-hotkey', 'title']\n        });\n\n        this.observers.set('composer', observer);\n      }\n    };\n\n    // Observe body for new composer instances\n    const observeBody = () => {\n      if (!this.observers.has('body')) {\n        const observer = new MutationObserver((mutations) => {\n          let needsCleanup = false;\n\n          mutations.forEach(mutation => {\n            if (mutation.type === 'childList') {\n              mutation.addedNodes.forEach(node => {\n                if (node.nodeType === Node.ELEMENT_NODE) {\n                  // Check for composer\n                  if (node.matches?.('#composer') || \n                      node.querySelector?.('#composer')) {\n                    setTimeout(observeComposer, 50);\n                    needsCleanup = true;\n                  }\n                }\n              });\n            }\n          });\n\n          if (needsCleanup) {\n            setTimeout(() => this.cleanup(), 100);\n          }\n        });\n\n        observer.observe(document.body, {\n          childList: true,\n          subtree: true\n        });\n\n        this.observers.set('body', observer);\n      }\n    };\n\n    observeComposer();\n    observeBody();\n  }\n\n  /**\n   * Stop all observers\n   */\n  stopObserving() {\n    this.observers.forEach(observer => observer.disconnect());\n    this.observers.clear();\n  }\n\n  /**\n   * Initialize the page management system\n   */\n  initialize() {\n    // Initial cleanup\n    this.cleanup();\n    \n    // Start observing for changes\n    this.startObserving();\n    \n    // Periodic cleanup as fallback\n    setInterval(() => {\n      if (document.querySelector('.TextEditor-toolbar')) {\n        this.cleanup();\n      }\n    }, 30000);\n  }\n}","import app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\nimport HeaderPrimary from 'flarum/forum/components/HeaderPrimary';\nimport HeaderSecondary from 'flarum/forum/components/HeaderSecondary';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport Navigation from 'flarum/forum/components/Navigation';\n\nimport CustomDiscussionRow from './components/CustomDiscussionRow';\nimport DiscussionListHeader from './components/DiscussionListHeader';\nimport HeroSection from './components/HeroSection';\nimport Logo from './components/Logo';\nimport CustomDiscussionTabNavigation from './components/CustomDiscussionTabNavigation';\nimport CustomMobileDiscussionToolbar from './components/CustomMobileDiscussionToolbar';\nimport CustomMobileDrawer from './components/CustomMobileDrawer';\nimport CustomMobileComposer from './components/CustomMobileComposer';\nimport CustomMobileCreateModal from './components/CustomMobileCreateModal';\nimport PageManager from './components/ToolbarCleanup';\n\napp.initializers.add('vietvan-ca-themes', () => {\n  // ==========================================\n  // Initialize Page Management System\n  // ==========================================\n  const pageManager = new PageManager();\n  pageManager.initialize();\n\n  // ==========================================\n  // Initialize Custom Mobile Composer (with delay)\n  // ==========================================\n  setTimeout(() => {\n    try {\n      CustomMobileComposer.init();\n    } catch (error) {\n      console.error('CustomMobileComposer initialization error:', error);\n    }\n  }, 1000);\n\n  // ==========================================\n  // Debug: Test CustomMobileDrawer import\n  // ==========================================\n  console.log('CustomMobileDrawer component:', CustomMobileDrawer);\n  console.log('Mithril m function:', m);\n\n  // ==========================================\n  // Alternative Approach: Separate Mobile Drawer\n  // ==========================================\n\n  /*\n  // TEMPORARILY DISABLED FOR DESKTOP TESTING\n  \n  const createMobileDrawer = () => {\n    // Only create on mobile\n    if (window.innerWidth > 768) return;\n    \n    // Check if mobile drawer already exists\n    if (document.querySelector('.vietvan-mobile-drawer')) return;\n    \n    console.log('Creating separate mobile drawer');\n    \n    // Create a completely separate mobile drawer\n    const mobileDrawer = document.createElement('div');\n    mobileDrawer.className = 'vietvan-mobile-drawer';\n    mobileDrawer.id = 'vietvan-mobile-drawer';\n    \n    // Style it to overlay the original drawer on mobile\n    mobileDrawer.style.cssText = `\n      position: fixed;\n      top: 0;\n      right: -100%;\n      width: 280px;\n      height: 100vh;\n      background: white;\n      z-index: 1050;\n      transition: right 0.3s ease;\n      box-shadow: -2px 0 10px rgba(0,0,0,0.1);\n    `;\n    \n    // Mount our custom component\n    m.mount(mobileDrawer, CustomMobileDrawer);\n    \n    // Add to body\n    document.body.appendChild(mobileDrawer);\n    \n    // Override the drawer toggle functionality on mobile\n    const originalDrawerToggle = document.querySelector('.App-drawerToggle, [data-drawer-toggle]');\n    if (originalDrawerToggle) {\n      originalDrawerToggle.addEventListener('click', (e) => {\n        if (window.innerWidth <= 768) {\n          e.preventDefault();\n          e.stopPropagation();\n          \n          // Toggle our custom drawer\n          const isOpen = mobileDrawer.style.right === '0px';\n          mobileDrawer.style.right = isOpen ? '-100%' : '0px';\n          document.body.classList.toggle('vietvan-drawer-open', !isOpen);\n        }\n      });\n    }\n    \n    console.log('Separate mobile drawer created');\n  };\n  \n  const removeMobileDrawer = () => {\n    const mobileDrawer = document.querySelector('.vietvan-mobile-drawer');\n    if (mobileDrawer) {\n      console.log('Removing separate mobile drawer');\n      m.mount(mobileDrawer, null);\n      mobileDrawer.remove();\n      document.body.classList.remove('vietvan-drawer-open');\n    }\n  };\n  \n  const handleResponsiveDrawer = () => {\n    if (window.innerWidth <= 768) {\n      createMobileDrawer();\n    } else {\n      removeMobileDrawer();\n    }\n  };\n  \n  // Global flag to track if we should use custom drawer\n  let useCustomDrawer = false;\n  \n  const checkMobileState = () => {\n    const isMobile = window.innerWidth <= 768;\n    useCustomDrawer = isMobile;\n    console.log('Mobile state check:', { width: window.innerWidth, isMobile, useCustomDrawer });\n    return isMobile;\n  };\n\n  const injectCustomDrawer = () => {\n    const isMobile = checkMobileState();\n    \n    if (!isMobile) {\n      // On desktop, only remove custom elements if they exist, don't touch original content\n      const customElements = document.querySelectorAll('.CustomMobileDrawer, .CustomMobileDrawer-wrapper');\n      if (customElements.length > 0) {\n        console.log('Removing custom drawer elements from desktop');\n        customElements.forEach(el => {\n          const wrapper = el.closest('.CustomMobileDrawer-wrapper');\n          if (wrapper) {\n            m.mount(wrapper, null);\n            wrapper.remove();\n          } else {\n            el.remove();\n          }\n        });\n        \n        // Restore original content if drawer was cleared\n        const drawer = document.querySelector('#drawer, .App-drawer, [id*=\"drawer\"]');\n        if (drawer) {\n          const originalContent = drawer.getAttribute('data-original-content');\n          if (originalContent && drawer.innerHTML.trim() === '') {\n            console.log('Restoring original drawer content on desktop');\n            drawer.innerHTML = originalContent;\n            drawer.removeAttribute('data-original-content');\n          }\n        }\n      }\n      return; // Exit early on desktop\n    }\n    \n    console.log('Checking drawer injection for mobile, window width:', window.innerWidth);\n    \n    const drawer = document.querySelector('#drawer, .App-drawer, [id*=\"drawer\"]');\n    \n    if (drawer && !drawer.querySelector('.CustomMobileDrawer')) {\n      console.log('Injecting CustomMobileDrawer into mobile view:', drawer);\n      \n      // Only store and clear content on mobile\n      const originalContent = drawer.innerHTML;\n      if (originalContent.trim() !== '') {\n        drawer.setAttribute('data-original-content', originalContent);\n        console.log('Stored original content:', originalContent.substring(0, 100) + '...');\n      }\n      \n      // Clear existing content only on mobile\n      drawer.innerHTML = '';\n      \n      // Create wrapper\n      const wrapper = document.createElement('div');\n      wrapper.className = 'CustomMobileDrawer-wrapper';\n      \n      // Mount component\n      m.mount(wrapper, CustomMobileDrawer);\n      drawer.appendChild(wrapper);\n      \n      console.log('CustomMobileDrawer injected successfully on mobile');\n    }\n  };\n\n  // Watch for drawer element creation (mobile only)\n  const observeDrawer = () => {\n    const observer = new MutationObserver((mutations) => {\n      // Only observe when custom drawer should be active\n      if (useCustomDrawer) {\n        mutations.forEach((mutation) => {\n          mutation.addedNodes.forEach((node) => {\n            if (node.nodeType === 1) { // Element node\n              // Check if the added node is a drawer or contains a drawer\n              if (node.id === 'drawer' || \n                  node.classList?.contains('App-drawer') ||\n                  node.querySelector?.('#drawer, .App-drawer')) {\n                setTimeout(injectCustomDrawer, 100);\n              }\n            }\n          });\n        });\n      }\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n\n    return observer;\n  };\n\n  // Initialize responsive drawer\n  document.addEventListener('DOMContentLoaded', handleResponsiveDrawer);\n  setTimeout(handleResponsiveDrawer, 500);\n  setTimeout(handleResponsiveDrawer, 1000);\n\n  // Handle window resize\n  let resizeTimeout;\n  window.addEventListener('resize', () => {\n    clearTimeout(resizeTimeout);\n    resizeTimeout = setTimeout(() => {\n      console.log('Window resized, handling responsive drawer');\n      handleResponsiveDrawer();\n    }, 250);\n  });\n\n  // Run on route changes\n  if (app.history) {\n    app.history.initialized?.then(() => {\n      app.history.router.on('changed', () => {\n        setTimeout(handleResponsiveDrawer, 100);\n      });\n    });\n  }\n\n  // END OF TEMPORARILY DISABLED MOBILE DRAWER CODE\n  */\n\n  // ==========================================\n  // Simple Mobile-Only Custom Drawer (Non-Interfering)\n  // ==========================================\n\n  const createMobileDrawer = () => {\n    // Only create on mobile devices\n    if (window.innerWidth > 768) return;\n\n    // Check if mobile drawer already exists\n    if (document.querySelector('.vietvan-mobile-drawer')) return;\n\n    console.log('Creating simple mobile drawer');\n\n    // Create a completely separate mobile drawer\n    const mobileDrawer = document.createElement('div');\n    mobileDrawer.className = 'vietvan-mobile-drawer';\n    mobileDrawer.id = 'vietvan-mobile-drawer';\n\n    // Style it to overlay on mobile (hidden by default)\n    mobileDrawer.style.cssText = `\n      position: fixed;\n      top: 0;\n      right: -100%;\n      width: 280px;\n      height: 100vh;\n      background: white;\n      z-index: 1050;\n      transition: right 0.3s ease;\n      box-shadow: -2px 0 10px rgba(0,0,0,0.1);\n      overflow-y: auto;\n    `;\n\n    // Mount our custom component\n    try {\n      m.mount(mobileDrawer, CustomMobileDrawer);\n      console.log('CustomMobileDrawer mounted successfully');\n    } catch (error) {\n      console.error('Error mounting CustomMobileDrawer:', error);\n      return;\n    }\n\n    // Add to body\n    document.body.appendChild(mobileDrawer);\n    console.log('Mobile drawer added to body');\n\n    // Add simple hamburger menu integration (non-interfering)\n    const setupHamburgerIntegration = () => {\n      const hamburger = document.querySelector('.App-drawerToggle, .Button--icon[aria-label*=\"menu\"], .Header-controls .Button--icon');\n      if (hamburger && window.innerWidth <= 768) {\n        console.log('Found hamburger button, adding mobile integration');\n\n        // Add a simple click listener that doesn't interfere with default behavior\n        hamburger.addEventListener('click', (e) => {\n          if (window.innerWidth <= 768) {\n            // Small delay to let default drawer start opening, then show ours instead\n            setTimeout(() => {\n              const defaultDrawer = document.querySelector('#drawer, .App-drawer');\n              if (defaultDrawer && defaultDrawer.classList.contains('in')) {\n                // Default drawer is opening, hide it and show ours\n                defaultDrawer.classList.remove('in');\n                defaultDrawer.style.transform = 'translateX(-100%)';\n\n                // Show our custom drawer\n                mobileDrawer.style.right = '0px';\n                document.body.classList.add('vietvan-drawer-open');\n                console.log('Switched from default to custom drawer');\n              }\n            }, 50);\n          }\n        });\n      }\n    };\n\n    // Setup hamburger integration with delays\n    setTimeout(setupHamburgerIntegration, 500);\n    setTimeout(setupHamburgerIntegration, 1000);\n\n    console.log('Simple mobile drawer created successfully');\n  };\n\n  const removeMobileDrawer = () => {\n    const mobileDrawer = document.querySelector('.vietvan-mobile-drawer');\n    if (mobileDrawer) {\n      console.log('Removing mobile drawer for desktop');\n      m.mount(mobileDrawer, null);\n      mobileDrawer.remove();\n      document.body.classList.remove('vietvan-drawer-open');\n    }\n  };\n\n  const handleResponsiveDrawer = () => {\n    if (window.innerWidth <= 768) {\n      createMobileDrawer();\n    } else {\n      removeMobileDrawer();\n    }\n  };\n\n  // Initialize mobile drawer (simple approach)\n  setTimeout(() => {\n    if (window.innerWidth <= 768) {\n      createMobileDrawer();\n    }\n  }, 1000);\n\n  // Handle window resize\n  let mobileResizeTimeout;\n  window.addEventListener('resize', () => {\n    clearTimeout(mobileResizeTimeout);\n    mobileResizeTimeout = setTimeout(handleResponsiveDrawer, 250);\n  });\n\n  // ==========================================\n  // Change Hide Button Icon to Eye\n  // ==========================================\n\n  // Use DOM manipulation to change the hide button icon after render\n  const changeHideButtonIcons = () => {\n    const hideButtons = document.querySelectorAll('.item-hide button .fa-trash-alt');\n    hideButtons.forEach(icon => {\n      if (icon.classList.contains('fa-trash-alt')) {\n        icon.classList.remove('fa-trash-alt');\n        icon.classList.add('fa-eye');\n      }\n    });\n\n    // Change hidden badge icons\n    const hiddenBadges = document.querySelectorAll('.item-hidden .fas.fa-trash, .Badge--hidden .fas.fa-trash');\n    hiddenBadges.forEach(icon => {\n      if (icon.classList.contains('fa-trash')) {\n        icon.classList.remove('fa-trash');\n        icon.classList.add('fa-eye');\n      }\n    });\n  };\n\n  // Run icon replacement on page load and route changes\n  const initializeHideButtonChanges = () => {\n    // Initial run\n    setTimeout(changeHideButtonIcons, 500);\n\n    // Run on route changes\n    if (app.history?.initialized) {\n      app.history.initialized.then(() => {\n        app.history.router.on('changed', () => {\n          setTimeout(changeHideButtonIcons, 500);\n        });\n      });\n    }\n\n    // Also run periodically to catch dynamically loaded content\n    setInterval(changeHideButtonIcons, 2000);\n  };\n\n  initializeHideButtonChanges();\n\n  // ==========================================\n  // Set Light Theme as Default\n  // ==========================================\n  const setDefaultLightTheme = () => {\n    // Only set default if user hasn't explicitly chosen a theme preference\n    if (app.session.user) {\n      const nightModePreference = app.session.user.preferences().fofNightMode;\n\n      // If night mode preference is null/undefined, set default to light\n      if (nightModePreference === null || nightModePreference === undefined) {\n        app.session.user.savePreferences({\n          fofNightMode: false\n        }).catch(() => {\n          // Ignore errors if preferences can't be saved\n        });\n      }\n    }\n\n    // For guests, remove any dark theme classes that might be applied by system preferences\n    const body = document.body;\n    const html = document.documentElement;\n\n    // Check if no explicit theme choice has been made\n    const hasExplicitDarkTheme = localStorage.getItem('fof-nightmode') === 'true' ||\n      localStorage.getItem('darkMode') === 'true';\n\n    if (!hasExplicitDarkTheme) {\n      // Remove potential system-applied dark classes\n      [body, html].forEach(element => {\n        if (element) {\n          const darkClasses = ['dark', 'dark-mode', 'fof-nightmode'];\n          darkClasses.forEach(className => {\n            element.classList.remove(className);\n          });\n        }\n      });\n    }\n  };\n\n  // Initialize default light theme\n  const initializeDefaultTheme = () => {\n    // Set default theme once when app loads\n    setTimeout(setDefaultLightTheme, 100);\n  };\n\n  initializeDefaultTheme();\n\n  // ==========================================\n  // Auto Text Color for Discussion Tags and Buttons\n  // ==========================================\n  const adjustTextColors = () => {\n    // Handle discussion tags\n    const coloredTags = document.querySelectorAll('.discussion-tag.colored');\n    coloredTags.forEach(tag => adjustElementTextColor(tag, 'backgroundColor'));\n\n    // Handle colored buttons (like create discussion button)\n    const coloredButtons = document.querySelectorAll('.Button--tagColored, .Button--primary[style*=\"--color\"]');\n    coloredButtons.forEach(button => {\n      // Check if button has custom --color property\n      const customColor = button.style.getPropertyValue('--color');\n      if (customColor) {\n        adjustElementTextColor(button, 'customColor', customColor);\n      }\n    });\n  };\n\n  const adjustElementTextColor = (element, colorSource, customColor = null) => {\n    let backgroundColor;\n\n    if (colorSource === 'customColor' && customColor) {\n      backgroundColor = customColor;\n    } else {\n      backgroundColor = window.getComputedStyle(element).backgroundColor;\n    }\n\n    // Parse color values - handle both rgb() and hex formats\n    let r, g, b;\n\n    if (backgroundColor.startsWith('#')) {\n      // Handle hex colors - fix the parsing\n      const hex = backgroundColor.replace('#', '');\n      if (hex.length === 3) {\n        // Handle short hex like #FFF\n        r = parseInt(hex.substr(0, 1) + hex.substr(0, 1), 16);\n        g = parseInt(hex.substr(1, 1) + hex.substr(1, 1), 16);\n        b = parseInt(hex.substr(2, 1) + hex.substr(2, 1), 16);\n      } else if (hex.length === 6) {\n        // Handle full hex like #FFF300\n        r = parseInt(hex.substr(0, 2), 16);\n        g = parseInt(hex.substr(2, 2), 16);\n        b = parseInt(hex.substr(4, 2), 16);\n      } else {\n        return; // Skip if invalid hex format\n      }\n    } else {\n      // Handle rgb() colors\n      const rgbMatch = backgroundColor.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n      if (rgbMatch) {\n        [, r, g, b] = rgbMatch.map(Number);\n      } else {\n        return; // Skip if can't parse color\n      }\n    }\n\n    // Calculate different brightness metrics\n    const wcagLuminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\n    const perceivedBrightness = Math.sqrt(0.241 * r * r + 0.691 * g * g + 0.068 * b * b) / 255;\n    const averageBrightness = (r + g + b) / (3 * 255);\n\n    // Calculate saturation to detect bright colors\n    const max = Math.max(r, g, b) / 255;\n    const min = Math.min(r, g, b) / 255;\n    const saturation = max === 0 ? 0 : (max - min) / max;\n\n    // Calculate contrast ratios with black and white text\n    const contrastWithBlack = (Math.max(wcagLuminance, 0.05) + 0.05) / (0.05 + 0.05);\n    const contrastWithWhite = (1.05) / (Math.max(wcagLuminance, 0.05) + 0.05);\n\n    // For very bright colors like yellow (#FFF300), use lower threshold\n    // Yellow and bright colors should use black text\n    const brightnessThreshold = saturation > 0.8 && wcagLuminance > 0.7 ? 0.6 :\n      saturation > 0.4 ? 0.75 : 0.65;\n\n    const shouldUseBlackText = wcagLuminance > brightnessThreshold &&\n      perceivedBrightness > (brightnessThreshold - 0.1) &&\n      averageBrightness > (brightnessThreshold - 0.15) &&\n      contrastWithBlack > contrastWithWhite;\n\n    // Apply styles with !important for stronger override\n    element.style.setProperty('color', shouldUseBlackText ? '#000000' : '#ffffff', 'important');\n\n    // Add appropriate text shadow with better contrast for colorful backgrounds\n    const textShadow = shouldUseBlackText\n      ? '0 0 1px rgba(255, 255, 255, 0.6)'\n      : '0 0 1px rgba(0, 0, 0, 0.8)';\n    element.style.setProperty('text-shadow', textShadow, 'important');\n\n    // For buttons, also ensure the background color is applied correctly\n    if (colorSource === 'customColor' && customColor) {\n      element.style.setProperty('background-color', customColor, 'important');\n      // Remove any conflicting classes\n      element.classList.remove('text-contrast--dark', 'text-contrast--light');\n    }\n  };\n\n  // Initialize text color adjustment\n  const initializeTextColors = () => {\n    // Initial run\n    setTimeout(adjustTextColors, 200);\n\n    // Run on route changes\n    if (app.history?.initialized) {\n      app.history.initialized.then(() => {\n        app.history.router.on('changed', () => {\n          setTimeout(adjustTextColors, 200);\n        });\n      });\n    }\n\n    // Run periodically to catch dynamically loaded content\n    setInterval(adjustTextColors, 3000);\n\n    // Watch for DOM changes (new discussions loaded)\n    const observer = new MutationObserver(() => {\n      setTimeout(adjustTextColors, 100);\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n  };\n\n  initializeTextColors();\n\n  // ==========================================\n  // TextEditor Extensions (Removed to prevent context issues)\n  // ==========================================\n\n  // Alternative approach: Use DOM observation for toolbar cleanup\n  const observeTextEditors = () => {\n    const observer = new MutationObserver((mutations) => {\n      let needsCleanup = false;\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeType === Node.ELEMENT_NODE) {\n            if (node.matches?.('.TextEditor') || \n                node.querySelector?.('.TextEditor') || \n                node.matches?.('.TextEditor-toolbar') || \n                node.querySelector?.('.TextEditor-toolbar')) {\n              needsCleanup = true;\n            }\n          }\n        });\n      });\n      \n      if (needsCleanup) {\n        setTimeout(() => {\n          pageManager.cleanup();\n          pageManager.configureDirectUpload();\n        }, 100);\n      }\n    });\n    \n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n  };\n  \n  // Start observing after a delay\n  setTimeout(observeTextEditors, 1000);\n\n  // Use oncreate to inject custom mobile drawer after IndexPage is created\n  /*\n  // TEMPORARILY DISABLED - CAUSING DESKTOP HEADER ISSUES\n  extend(IndexPage.prototype, 'oncreate', function() {\n    this.injectCustomDrawer();\n    // Removed aggressive loading management\n  });\n\n  extend(IndexPage.prototype, 'onupdate', function() {\n    this.injectCustomDrawer();\n    // Removed aggressive loading management\n  });\n\n  // Add method to inject custom drawer\n  IndexPage.prototype.injectCustomDrawer = function() {\n    // Try multiple possible drawer selectors\n    const drawer = document.getElementById('drawer') || \n                   document.querySelector('.App-drawer') || \n                   document.querySelector('#app-navigation .Drawer');\n    \n    if (drawer && !drawer.querySelector('.CustomMobileDrawer')) {\n      console.log('Found drawer element:', drawer);\n      \n      // Try multiple possible content selectors\n      let drawerContent = drawer.querySelector('.Drawer-content') || \n                         drawer.querySelector('.App-drawer') || \n                         drawer.querySelector('.Drawer') ||\n                         drawer;\n      \n      if (drawerContent) {\n        console.log('Found drawer content:', drawerContent);\n        \n        // Create container if it doesn't exist\n        let customDrawerContainer = drawerContent.querySelector('.CustomMobileDrawer-container');\n        if (!customDrawerContainer) {\n          customDrawerContainer = document.createElement('div');\n          customDrawerContainer.className = 'CustomMobileDrawer-container';\n          \n          try {\n            // Mount the custom drawer component\n            m.mount(customDrawerContainer, CustomMobileDrawer);\n            console.log('CustomMobileDrawer mounted successfully');\n            \n            // Clear existing content and add our custom drawer\n            drawerContent.innerHTML = '';\n            drawerContent.appendChild(customDrawerContainer);\n            \n          } catch (error) {\n            console.error('Error mounting CustomMobileDrawer:', error);\n          }\n        }\n      } else {\n        console.log('Drawer content not found');\n      }\n    } else if (!drawer) {\n      console.log('Drawer element not found');\n    }\n  };\n  */\n\n  // Utility function to find element by class path\n  const findElementByPath = (vnode, path) => {\n    let current = vnode;\n\n    for (const className of path) {\n      if (!current?.children || !Array.isArray(current.children)) {\n        return null;\n      }\n\n      const found = current.children.find((child) => child?.attrs?.className?.includes(className));\n\n      if (!found) return null;\n      current = found;\n    }\n\n    return current;\n  };\n\n  // Check for register button visibility using document events\n  const checkRegisterButtonVisibility = () => {\n    try {\n      if (app.forum?.attribute) {\n        const showRegisterButton = app.forum.attribute('vietvan_ca_show_register_button') === '1';\n\n        if (!showRegisterButton) {\n          const registerButton = document.querySelector('.item-signUp');\n          registerButton?.remove();\n        }\n      }\n    } catch (error) {\n      console.error('Error checking register button visibility:', error);\n    }\n  };\n\n  // Check for custom logo, if it exists, remove the default logo\n  const checkCustomLogo = () => {\n    try {\n      const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\n      const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\n\n      if (lightLogoPath || darkLogoPath) {\n        const defaultLogo = document.querySelector('.Header-title');\n        defaultLogo?.remove();\n      }\n    } catch (error) {\n      console.error('Error checking custom logo:', error);\n    }\n  };\n\n  // Run all component checks\n  const runComponentChecks = () => {\n    checkRegisterButtonVisibility();\n    checkCustomLogo();\n  };\n\n  // Initialize component checks\n  const initializeChecks = () => {\n    if (document.readyState === 'complete' || document.readyState === 'interactive') {\n      setTimeout(runComponentChecks, 100);\n    } else {\n      document.addEventListener('DOMContentLoaded', () => {\n        setTimeout(runComponentChecks, 100);\n      });\n    }\n\n    // Run when route changes\n    app.history.initialized?.then(() => {\n      app.history.router.on('changed', runComponentChecks);\n    });\n  };\n\n  // Initialize checks\n  initializeChecks();\n\n  // Extend the HeaderPrimary component to replace the logo with a custom one\n  extend(HeaderPrimary.prototype, 'items', function (items) {\n    const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\n    const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\n\n    if (lightLogoPath || darkLogoPath) {\n      items.add('logo', <Logo />, 90);\n    }\n  });\n\n  // Extend the HeaderSecondary component to remove the search component\n  extend(HeaderSecondary.prototype, 'items', function (items) {\n    if (items.has('search')) {\n      items.remove('search');\n    }\n  });\n\n  // Extend the DiscussionListItem component to use the custom row\n  extend(DiscussionListItem.prototype, 'view', function (vnode) {\n    vnode.children = [\n      m(CustomDiscussionRow, {\n        discussion: this.attrs.discussion,\n      }),\n    ];\n  });\n\n  // Extend the DiscussionList component to add a header\n  extend(DiscussionList.prototype, 'view', function (vnode) {\n    const originalChildren = vnode.children;\n    vnode.children = [m('ul.DiscussionList', [m(DiscussionListHeader), ...originalChildren])];\n  });\n\n  // Extend the IndexPage component to add a hero section and custom tabs\n  extend(IndexPage.prototype, 'view', function (vnode) {\n    // Add HeroSection at the beginning\n    const heroSectionInstance = m(HeroSection);\n    const originalChildren = vnode.children;\n    vnode.children = [heroSectionInstance, ...originalChildren];\n\n    // Create custom mobile discussion toolbar instance\n    const customMobileDiscussionToolbarInstance = <CustomMobileDiscussionToolbar />;\n\n    // Create custom tabs instance\n    const customTabsInstance = <CustomDiscussionTabNavigation />;\n\n    // Find toolbar using optimized path traversal\n    const toolbarPath = ['container', 'sideNavContainer', 'IndexPage-results', 'IndexPage-toolbar', 'IndexPage-toolbar-view'];\n    const toolbarDiv = findElementByPath({ children: originalChildren }, toolbarPath);\n\n    if (toolbarDiv) {\n      // Replace toolbar content with custom tabs\n      toolbarDiv.children = [customMobileDiscussionToolbarInstance, customTabsInstance];\n    } else {\n      console.warn('IndexPage-toolbar-view not found. CustomTabNavigation not added.');\n    }\n\n    // Run component checks after render\n    setTimeout(runComponentChecks, 100);\n  });\n\n  // Add mobile logo using DOM manipulation\n  extend(IndexPage.prototype, 'oncreate', function () {\n    const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\n    const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\n\n    if (lightLogoPath || darkLogoPath) {\n      this.addMobileLogo();\n    }\n  });\n\n  extend(IndexPage.prototype, 'onupdate', function () {\n    const lightLogoPath = app.forum.attribute('vietvan_ca_logoUrl');\n    const darkLogoPath = app.forum.attribute('vietvan_ca_logo_darkUrl');\n\n    if (lightLogoPath || darkLogoPath) {\n      this.addMobileLogo();\n    }\n  });\n\n  // Add method to IndexPage prototype\n  IndexPage.prototype.addMobileLogo = function () {\n    const navElement = document.getElementById('app-navigation');\n\n    if (navElement && !navElement.querySelector('.Navigation-logo')) {\n      // Create logo container\n      const logoDiv = document.createElement('div');\n      logoDiv.className = 'Navigation-logo Mobile-only';\n\n      // Mount Logo component into the div\n      m.mount(logoDiv, {\n        view: () => m(Logo, { imageStyle: { height: '30px' } }),\n      });\n\n      // Insert at the beginning of navigation (before App-backControl)\n      const backControl = navElement.querySelector('.App-backControl');\n      if (backControl) {\n        navElement.insertBefore(logoDiv, backControl);\n      } else {\n        navElement.insertBefore(logoDiv, navElement.firstChild);\n      }\n    }\n  };\n\n  extend(IndexPage.prototype, 'onremove', function () {\n    const navElement = document.getElementById('app-navigation');\n    const logoElement = navElement?.querySelector('.Navigation-logo');\n\n    if (logoElement) {\n      m.mount(logoElement, null); // Unmount the component\n      logoElement.remove();\n    }\n  });\n\n  // Adding scale font size feature\n  let currentScale = 1.05;\n\n  // Apply initial font zoom\n  applyFontZoom(currentScale);\n});\n\nfunction applyFontZoom(scale) {\n  // Remove existing font zoom styles\n  const existingStyle = document.getElementById('font-zoom-style');\n  if (existingStyle) {\n    existingStyle.remove();\n  }\n\n  // Create new style element\n  const style = document.createElement('style');\n  style.id = 'font-zoom-style';\n\n  // Apply zoom to various elements\n  style.textContent = `\n    .App {\n      font-size: ${scale}rem !important;\n    }\n    \n    /* Ensure consistent scaling across all text elements */\n    .Post-body,\n    .PostPreview-body,\n    .UserCard-info,\n    .NotificationGrid-content,\n    .Dropdown-menu,\n    .Modal-body,\n    .Form-group label,\n    .Form-group input,\n    .Form-group textarea,\n    .TagLabel,\n    .Badge {\n      font-size: ${scale}em !important;\n    }\n    \n    /* Scale headings proportionally */\n    h1 { font-size: ${scale * 2}rem !important; }\n    h2 { font-size: ${scale * 1.5}rem !important; }\n    h3 { font-size: ${scale * 1.25}rem !important; }\n    h4 { font-size: ${scale * 1.125}rem !important; }\n    h5 { font-size: ${scale * 1}rem !important; }\n    h6 { font-size: ${scale * 0.875}rem !important; }\n    \n    /* Scale code blocks */\n    code,\n    pre {\n      font-size: ${scale * 0.875}em !important;\n    }\n  `;\n\n  document.head.appendChild(style);\n\n  // Store for guests as mitigate if improved\n  localStorage.setItem('flarum-font-zoom-scale', scale.toString());\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","_inheritsLoose","create","constructor","TopicColumn","_Component","apply","arguments","view","discussion","this","attrs","firstPost","tags","isSticky","isLocked","m","icon","Link","href","app","title","map","tag","className","color","style","backgroundColor","name","attribute","contentPlain","Component","ReplyColumn","_discussion$replyCoun","replyCount","ViewColumn","viewCount","getColorClass","index","colorClasses","length","ActivityColumn","lastPostedAt","timeSince","date","dateObj","Date","isNaN","getTime","diffTime","diffDays","Math","floor","diffHours","diffMinutes","getTimeSince","LastUsersColumn","latestPosters","slice","user","i","username","userName","avatarUrl","avatar_url","src","alt","charAt","toUpperCase","renderUserAvatar","CustomDiscussionRow","DiscussionListHeader","trans","CustomMobileDiscussionToolbar","_proto","_this","currentDate","SelectDropdown","buttonClassName","getNavigationItems","toArray","class","type","onclick","newDiscussionAction","items","ItemList","add","LinkButton","allTags","all","filter","hasParent","parent","position","sort","b","forEach","id","slug","Promise","resolve","reject","load","DiscussionComposer","show","LogInModal","HeroSection","oninit","vnode","_forum$attribute","_forum$attribute2","forum","enabled","mode","extensions","setupNightModeListener","setupSystemModeListener","setupBodyClassObserver","setTimeout","computeMode","redraw","newMode","locale","translator","getLocale","titleKey","descKey","description","showText","hasCustomColor","titleStyle","descriptionStyle","titleColor","subtitleColor","_document$cookie$spli","document","body","classList","contains","session","pref","preferences","fofNightMode","window","matchMedia","matches","cookieValue","cookie","split","find","row","startsWith","_this2","nightModeHandler","event","detail","addEventListener","_this3","mediaQuery","systemModeHandler","_this4","bodyObserver","MutationObserver","observe","attributes","attributeFilter","onremove","removeEventListener","disconnect","getBackgroundStyle","bgAttr","bgUrl","height","backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","undefined","currentPath","location","pathname","backgroundStyle","Search","state","search","Logo","_app$session$user","logoAttr","logoUrl","customUrl","imageStyle","CustomDiscussionTabNavigation","_app$search$params","currentSort","params","tabs","label","sortParam","default","tab","isActive","routeName","isFilter","q","includes","filterParam","navigateTo","newPath","route","set","fallback","result","CustomMobileDrawer","toggleDrawer","listItems","menuItems","loggedInSection","guestSection","mainSiteUrl","replace","guidelinesTag","findTagBySlug","languageDropdown","themeToggle","locales","currentLocale","keys","getLocaleName","toggleDropdown","changeLocale","_app$data$locales","savePreferences","then","reload","toggleTheme","nightModeToggle","querySelector","click","toggle","isDark","localStorage","setItem","dropdownId","preventDefault","stopPropagation","dropdown","getElementById","baseMainUrl","showLoginModal","socialLogin","provider","backendUrl","console","error","alert","drawer","right","remove","generateRandomString","oauthUrl","encodeURIComponent","origin","log","popup","open","screen","width","focus","_this5","displayName","logout","isOpen","defaultLoginButton","confirmMessage","confirm","chars","random","CustomMobileCreateModal","_content","selectedTag","isSubmitting","innerWidth","isVisible","hide","value","onchange","target","getTagOptions","placeholder","oninput","TextEditor","getContent","setContent","onupdate","configureDirectUpload","submit","disabled","canSubmit","canStartDiscussion","editorContainer","selector","querySelectorAll","el","display","visibility","parentNode","removeChild","join","btn","textContent","toLowerCase","fileInput","accept","multiple","toolbar","enhanceDirectUpload","container","previousElementSibling","originalHandler","file","files","opacity","pointerEvents","handleDirectUpload","warn","button","trim","composer","requestData","data","content","relationships","method","url","response","pushPayload","errorMessage","errors","createElement","appendChild","mount","CustomMobileComposer","init","interceptCreateTopicButtons","mountModal","_target$getAttribute","_target$getAttribute2","closest","some","getAttribute","stopImmediatePropagation","mutations","mutation","addedNodes","node","nodeType","Node","ELEMENT_NODE","childList","subtree","PageManager","observers","Map","isProcessing","cleanup","hideByAttributes","hideByPosition","hideUploadButtons","hideGalleryButtons","hideRichTextToggle","hideElement","editor","nextElementSibling","originalChange","alerts","element","dataset","vietvanHidden","setProperty","setAttribute","startObserving","_this6","observeComposer","has","observer","needsCleanup","observeBody","stopObserving","clear","initialize","_this7","setInterval","pageManager","mobileResizeTimeout","createMobileDrawer","mobileDrawer","cssText","setupHamburgerIntegration","hamburger","defaultDrawer","transform","handleResponsiveDrawer","clearTimeout","_app$history","changeHideButtonIcons","initialized","router","on","nightModePreference","html","documentElement","getItem","_app$history2","adjustTextColors","adjustElementTextColor","customColor","getPropertyValue","colorSource","r","g","getComputedStyle","hex","parseInt","substr","rgbMatch","match","_rgbMatch$map","Number","wcagLuminance","perceivedBrightness","sqrt","averageBrightness","max","min","saturation","contrastWithBlack","contrastWithWhite","brightnessThreshold","shouldUseBlackText","textShadow","_app$history$initiali","runComponentChecks","_app$forum","registerButton","checkRegisterButtonVisibility","lightLogoPath","darkLogoPath","defaultLogo","checkCustomLogo","readyState","extend","HeaderPrimary","HeaderSecondary","DiscussionListItem","children","DiscussionList","originalChildren","concat","IndexPage","heroSectionInstance","customMobileDiscussionToolbarInstance","customTabsInstance","toolbarDiv","_ret","_step","current","_loop","_current","Array","isArray","v","found","child","_child$attrs","_iterator","_createForOfIteratorHelperLoose","done","findElementByPath","addMobileLogo","navElement","logoDiv","backControl","insertBefore","firstChild","logoElement","scale","existingStyle","head","toString","applyFontZoom"],"sourceRoot":""}
>>>>>>> 91b97b6f23384e3c5dfd6413f6fdb78c0aa4b00c
